# 🎯 송도픽(SongdoPick) 프로젝트 종합 점검 보고서

**작성일**: 2025년 1월  
**점검 범위**: 전체 프로젝트 (프론트엔드 + 백엔드 + 인프라)

---

## 1️⃣ 프로젝트 한 장 요약

### 프로젝트 개요
**송도픽(SongdoPick)**은 **공동구매(공구) 플랫폼**으로, 송도 지역 주민들이 상품을 함께 주문하고 픽업하는 서비스입니다.

### 핵심 비즈니스 모델
- **공구 회차 시스템**: 한 상품을 여러 회차로 나누어 판매 (예: 1차, 2차, 추가공구)
- **픽업 기반**: 온라인 주문 후 오프라인 픽업 방식
- **등급 시스템**: 픽업/노쇼 이력 기반의 신뢰도 등급 (공구의 신 → 공구왕 → 공구요정 → 공구새싹 → 공구초보)
- **포인트 시스템**: 가입 보너스, 출석 미션, 추천인 코드 등으로 포인트 적립
- **대기자 명단**: 품절 시 대기 신청 가능, 재고 확보 시 자동 알림

### 기술 스택
- **프론트엔드**: React 18 + TypeScript + Vite
- **백엔드**: Firebase (Firestore, Auth, Storage, Cloud Functions v2)
- **배포**: Vercel (프론트), Firebase Hosting (Functions)
- **상태관리**: React Context API + TanStack Query
- **라우팅**: React Router v7

---

## 2️⃣ 핵심 플로우 지도

### 고객 플로우
```
[로그인] → [상품 목록] → [상품 상세] → [장바구니/즉시구매]
    ↓
[주문 생성 (RESERVED)] → [선입금 (PREPAID)] → [픽업 (PICKED_UP)]
    ↓
[포인트 적립] → [등급 상승 가능]
```

### 관리자 플로우
```
[상품 등록] → [회차 설정] → [재고 관리] → [주문 관리]
    ↓
[픽업 확인] → [선입금 확인] → [대기자 처리] → [재고 업데이트]
```

### 데이터 흐름
```
클라이언트 → Cloud Function (Callable) → Firestore Transaction
    ↓
Firestore Trigger → 자동 집계/포인트/알림 처리
```

---

## 3️⃣ 리스크 Top 10 (심각도 순)

### 🔴 **심각 (즉시 수정 필요)**

#### 1. **Firebase API 키 하드코딩 노출** ⚠️ **CRITICAL**
- **위치**: `src/firebase/firebaseConfig.ts:18-26`
- **문제**: FALLBACK 객체에 실제 Firebase API 키가 하드코딩되어 있음
- **위험도**: ⭐⭐⭐⭐⭐ (5/5)
- **영향**: 소스코드가 공개되면 누구나 Firebase 프로젝트에 접근 가능
- **수정 난이도**: ⭐ (1/5) - 매우 쉬움
- **조치**: FALLBACK 제거, 환경변수 필수화

```typescript
// ❌ 현재 (위험)
const FALLBACK = {
  apiKey: "AIzaSyBLN5zX4RT8AHIuNQjvPCdz2qXRJpjzWCs", // 노출됨!
  // ...
};

// ✅ 수정안
const firebaseConfig = {
  apiKey: import.meta.env.VITE_FIREBASE_API_KEY, // 필수, 없으면 에러
  // ...
};
if (!firebaseConfig.apiKey) {
  throw new Error("VITE_FIREBASE_API_KEY 환경변수가 필요합니다.");
}
```

---

#### 2. **서비스 계정 키 파일 Git 추적 가능성** ⚠️ **CRITICAL**
- **위치**: `scripts/serviceAccountKey.json`, `functions/serviceAccountKey.json`
- **문제**: `.gitignore`에 있지만, 과거에 커밋되었을 가능성
- **위험도**: ⭐⭐⭐⭐⭐ (5/5)
- **영향**: 키가 유출되면 Firebase 프로젝트 전체 권한 탈취 가능
- **수정 난이도**: ⭐⭐ (2/5)
- **조치**:
  1. Git 히스토리에서 완전 삭제: `git filter-branch` 또는 BFG Repo-Cleaner
  2. Firebase 콘솔에서 키 재생성
  3. `.gitignore` 재확인 및 강화

---

#### 3. **관리자 권한 클라이언트 사이드만 체크** ⚠️ **HIGH**
- **위치**: `src/components/admin/AdminRoute.tsx`, `src/main.tsx:103-108`
- **문제**: 클라이언트에서만 `isAdmin` 체크, 서버 검증은 Cloud Function에만 의존
- **위험도**: ⭐⭐⭐⭐ (4/5)
- **영향**: 브라우저 개발자 도구로 우회 시도 가능 (Firestore Rules로 차단되지만)
- **수정 난이도**: ⭐⭐⭐ (3/5)
- **조치**: Firestore Rules는 이미 적절함. 추가로 App Check 활성화 권장

---

### 🟡 **중요 (1주일 내 수정 권장)**

#### 4. **환경변수 문서화 부족**
- **위치**: README.md에 일부만 명시
- **문제**: 로컬 개발자가 필요한 모든 환경변수 목록이 불명확
- **위험도**: ⭐⭐⭐ (3/5)
- **수정 난이도**: ⭐ (1/5)
- **조치**: `.env.example` 파일 생성 및 README 보완

---

#### 5. **Firestore 인덱스 누락 가능성**
- **위치**: `firestore.indexes.json` 확인 필요
- **문제**: 복합 쿼리 사용 시 인덱스 미생성으로 에러 발생 가능
- **위험도**: ⭐⭐⭐ (3/5)
- **수정 난이도**: ⭐⭐ (2/5)
- **조치**: 모든 `where` + `orderBy` 조합에 대한 인덱스 확인

---

#### 6. **재고 동시성 검증 부족**
- **위치**: `src/firebase/orderService.ts:30-70` (클라이언트 `submitOrder`)
- **문제**: 클라이언트에서 주문 생성 시 재고 검증 없음 (서버에서만 처리)
- **위험도**: ⭐⭐⭐ (3/5)
- **영향**: 클라이언트 `submitOrder`는 사용되지 않지만, 혼란 가능
- **수정 난이도**: ⭐ (1/5)
- **조치**: 클라이언트 `submitOrder` 함수 제거 또는 Deprecated 명확화

---

#### 7. **에러 로깅/모니터링 부재**
- **위치**: 전역
- **문제**: 프로덕션 에러 추적 시스템 없음
- **위험도**: ⭐⭐⭐ (3/5)
- **수정 난이도**: ⭐⭐⭐ (3/5)
- **조치**: Sentry 또는 Firebase Crashlytics 도입

---

### 🟢 **보통 (점진적 개선)**

#### 8. **Storage Rules 미확인**
- **위치**: `storage.rules` 파일 없음
- **문제**: Firebase Storage 접근 권한 규칙이 명시되지 않음
- **위험도**: ⭐⭐ (2/5)
- **수정 난이도**: ⭐⭐ (2/5)
- **조치**: Storage Rules 파일 생성 및 배포

---

#### 9. **CORS 설정 하드코딩**
- **위치**: `functions/src/firebase/admin.ts` (추정)
- **문제**: CORS 허용 도메인이 코드에 하드코딩되어 있을 가능성
- **위험도**: ⭐⭐ (2/5)
- **수정 난이도**: ⭐⭐ (2/5)
- **조치**: 환경변수로 관리

---

#### 10. **결제 검증 로직 확인 필요**
- **위치**: 결제 관련 코드 확인 필요
- **문제**: 선입금(PREPAID) 상태 변경 시 실제 결제 검증 여부 불명확
- **위험도**: ⭐⭐ (2/5)
- **수정 난이도**: ⭐⭐⭐ (3/5)
- **조치**: 결제 시스템 연동 여부 확인 및 서버 검증 강화

---

## 4️⃣ UX 문제 Top 10

### 🔴 **심각 (즉시 개선)**

#### 1. **모바일 반응형 일관성 부족**
- **위치**: 전역 CSS
- **문제**: 일부 컴포넌트가 모바일에서 레이아웃 깨짐 가능성
- **근거**: `CustomerLayout`, `ProductCard` 등에서 모바일 최적화 확인 필요
- **개선 난이도**: ⭐⭐⭐ (3/5)

---

#### 2. **로딩 상태 피드백 부족**
- **위치**: 여러 페이지
- **문제**: 데이터 로딩 중 빈 화면 또는 스켈레톤 UI 미적용 구간 존재
- **근거**: `ModernProductList` 등에서 로딩 상태 처리 확인 필요
- **개선 난이도**: ⭐⭐ (2/5)

---

### 🟡 **중요 (1주일 내 개선)**

#### 3. **에러 메시지 사용자 친화적이지 않음**
- **위치**: `src/firebase/productService.ts:565-570`
- **문제**: "DB 인덱스가 필요합니다" 같은 기술적 메시지
- **근거**: 일반 사용자에게는 "잠시 후 다시 시도해주세요"가 적절
- **개선 난이도**: ⭐ (1/5)

---

#### 4. **빈 상태(Empty State) 처리 부족**
- **위치**: 주문 내역, 장바구니 등
- **문제**: 데이터가 없을 때 안내 메시지/이미지 없음
- **근거**: `OrderHistoryPage` 등에서 빈 상태 확인 필요
- **개선 난이도**: ⭐⭐ (2/5)

---

#### 5. **접근성(A11y) 부족**
- **위치**: 전역
- **문제**: 키보드 네비게이션, 스크린 리더 지원 미흡
- **근거**: `alt` 속성, `aria-label` 등 확인 필요
- **개선 난이도**: ⭐⭐⭐ (3/5)

---

#### 6. **이미지 최적화는 있으나 지연 로딩 일관성 부족**
- **위치**: `OptimizedImage` 컴포넌트는 있으나 모든 곳에서 사용되지 않음
- **문제**: 일부 이미지가 `loading="lazy"` 미적용
- **근거**: `ProductCard`, `BannerSlider` 등에서 확인 필요
- **개선 난이도**: ⭐⭐ (2/5)

---

### 🟢 **보통 (점진적 개선)**

#### 7. **탐색 구조 복잡함**
- **위치**: `src/main.tsx` 라우팅 구조
- **문제**: `/`, `/modern`, `/simple`, `/beauty` 등 경로가 혼재
- **근거**: 사용자가 어떤 경로를 사용해야 할지 혼란 가능
- **개선 난이도**: ⭐⭐⭐ (3/5)

---

#### 8. **버튼/타이포 일관성 부족**
- **위치**: 전역 CSS
- **문제**: 버튼 스타일, 폰트 크기 등이 컴포넌트마다 상이할 가능성
- **근거**: 디자인 시스템 미구축
- **개선 난이도**: ⭐⭐⭐⭐ (4/5)

---

#### 9. **성공/실패 피드백 일관성 부족**
- **위치**: 전역
- **문제**: `react-hot-toast` 사용은 하지만 메시지 톤이 일관되지 않을 수 있음
- **근거**: 토스트 메시지 스타일/위치 확인 필요
- **개선 난이도**: ⭐⭐ (2/5)

---

#### 10. **오프라인 상태 처리 없음**
- **위치**: 전역
- **문제**: 네트워크 오류 시 사용자 안내 부족
- **근거**: Service Worker는 제거된 상태
- **개선 난이도**: ⭐⭐⭐ (3/5)

---

## 5️⃣ 빠른 승리(Quick Wins) 10개

### 30분~1시간 작업

1. **FALLBACK API 키 제거** (30분)
   - `src/firebase/firebaseConfig.ts`에서 FALLBACK 객체 제거
   - 환경변수 필수화 및 에러 메시지 추가

2. **`.env.example` 파일 생성** (30분)
   - 필요한 모든 환경변수 목록 작성
   - README에 환경변수 설정 가이드 추가

3. **에러 메시지 사용자 친화적으로 변경** (1시간)
   - 기술적 메시지를 일반 사용자용으로 변경
   - 예: "DB 인덱스 필요" → "잠시 후 다시 시도해주세요"

4. **빈 상태 컴포넌트 추가** (1시간)
   - 주문 내역, 장바구니 등에 빈 상태 UI 추가

5. **이미지 `loading="lazy"` 일괄 적용** (1시간)
   - 모든 `<img>` 태그에 `loading="lazy"` 추가 (첫 화면 제외)

---

### 1~2시간 작업

6. **Storage Rules 파일 생성** (1시간)
   - Firebase Storage 접근 권한 규칙 작성
   - 관리자만 업로드, 모든 사용자 읽기 등

7. **Firestore 인덱스 점검** (2시간)
   - 모든 쿼리 조합 확인
   - `firestore.indexes.json` 업데이트

8. **로딩 스켈레톤 UI 추가** (2시간)
   - 주요 페이지에 스켈레톤 UI 적용
   - `ModernProductList`, `ProductDetailPage` 등

9. **접근성 기본 개선** (2시간)
   - 모든 이미지에 `alt` 속성 추가
   - 버튼에 `aria-label` 추가

10. **콘솔 에러/경고 정리** (1시간)
    - 개발자 도구 콘솔의 에러/경고 메시지 해결
    - 불필요한 `console.log` 제거

---

## 6️⃣ 다음 3일 플랜

### 📅 **Day 1: 보안 긴급 수정**

**목표**: 즉시 수정이 필요한 보안 이슈 해결

#### 오전 (3시간)
- [ ] **FALLBACK API 키 제거** (30분)
  - `src/firebase/firebaseConfig.ts` 수정
  - 환경변수 필수화
- [ ] **서비스 계정 키 Git 히스토리 확인** (1시간)
  - `git log --all --full-history -- scripts/serviceAccountKey.json` 실행
  - 커밋 이력에 있다면 BFG Repo-Cleaner로 삭제
- [ ] **`.env.example` 파일 생성** (30분)
- [ ] **환경변수 문서화** (1시간)
  - README.md 보완

#### 오후 (3시간)
- [ ] **Storage Rules 파일 생성** (1시간)
- [ ] **Firestore Rules 재검토** (1시간)
  - 현재 규칙이 적절한지 확인
- [ ] **관리자 권한 체크 강화** (1시간)
  - App Check 활성화 검토

**완료 기준**: 보안 이슈 Top 3 해결 완료

---

### 📅 **Day 2: UX 개선 + 데이터 무결성 점검**

**목표**: 사용자 경험 개선 및 데이터 흐름 검증

#### 오전 (3시간)
- [ ] **에러 메시지 사용자 친화적으로 변경** (1시간)
- [ ] **빈 상태 컴포넌트 추가** (1시간)
  - 주문 내역, 장바구니 등
- [ ] **로딩 스켈레톤 UI 추가** (1시간)
  - 주요 페이지 3~4개

#### 오후 (3시간)
- [ ] **주문 플로우 검증** (2시간)
  - RESERVED → PREPAID → PICKED_UP 상태 전이 확인
  - 재고 차감 로직 검증
- [ ] **재고 동시성 테스트** (1시간)
  - 동시 주문 시나리오 테스트

**완료 기준**: UX 문제 Top 5 중 3개 해결, 주문 플로우 검증 완료

---

### 📅 **Day 3: 성능 최적화 + 문서화**

**목표**: 성능 개선 및 프로젝트 문서화

#### 오전 (3시간)
- [ ] **이미지 최적화 일괄 적용** (1시간)
  - 모든 이미지에 `loading="lazy"` 추가
- [ ] **Firestore 인덱스 점검** (2시간)
  - 쿼리 조합 확인 및 인덱스 생성

#### 오후 (3시간)
- [ ] **콘솔 에러/경고 정리** (1시간)
- [ ] **접근성 기본 개선** (1시간)
  - `alt`, `aria-label` 추가
- [ ] **프로젝트 문서 업데이트** (1시간)
  - README.md 보완
  - 개발 가이드 작성

**완료 기준**: Quick Wins 10개 중 7개 이상 완료, 문서화 완료

---

## 7️⃣ 추가 권장 사항

### 단기 (1주일 내)
1. **에러 모니터링 도입**: Sentry 또는 Firebase Crashlytics
2. **테스트 코드 작성**: 핵심 비즈니스 로직 (주문 생성, 재고 차감 등)
3. **성능 측정**: Lighthouse 점수 확인 및 개선

### 중기 (1개월 내)
1. **디자인 시스템 구축**: Storybook 도입
2. **PWA 기능 재도입**: 오프라인 지원 (Service Worker)
3. **다국어 지원**: i18n 라이브러리 도입 (필요 시)

### 장기 (3개월 내)
1. **마이크로서비스 전환 검토**: Firebase Functions 모듈화
2. **CDN 도입**: 이미지 최적화 및 전역 배포
3. **A/B 테스트**: 주요 기능 개선 효과 측정

---

## 8️⃣ 점검 완료 체크리스트

### 보안
- [ ] FALLBACK API 키 제거
- [ ] 서비스 계정 키 Git 히스토리 확인
- [ ] Storage Rules 생성
- [ ] 환경변수 문서화

### 데이터 무결성
- [ ] 주문 플로우 검증
- [ ] 재고 동시성 테스트
- [ ] Firestore 인덱스 점검

### UX
- [ ] 에러 메시지 개선
- [ ] 빈 상태 컴포넌트 추가
- [ ] 로딩 스켈레톤 UI 추가
- [ ] 이미지 최적화 일괄 적용

### 성능
- [ ] 콘솔 에러/경고 정리
- [ ] 번들 크기 확인
- [ ] Lighthouse 점수 측정

### 문서화
- [ ] `.env.example` 생성
- [ ] README.md 보완
- [ ] 개발 가이드 작성

---

## 📝 결론

송도픽 프로젝트는 **전반적으로 잘 구조화된 프로젝트**입니다. 특히:
- ✅ Firestore Rules가 적절히 설정되어 있음
- ✅ 주문 생성이 Cloud Function에서 처리되어 보안이 강화됨
- ✅ 재고 관리가 StockStats로 중앙화되어 있음
- ✅ 이미지 최적화 시스템이 구축되어 있음

하지만 **즉시 수정이 필요한 보안 이슈**가 있습니다:
1. **FALLBACK API 키 노출** (최우선)
2. **서비스 계정 키 Git 추적 가능성** (최우선)
3. **환경변수 문서화 부족** (중요)

**다음 3일 플랜**을 따라 단계적으로 개선하시면, 안정적이고 사용자 친화적인 서비스로 발전할 수 있습니다.

---

**작성자**: AI Assistant (Cursor)  
**최종 업데이트**: 2025년 1월








