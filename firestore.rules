rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // products, banners, categories 등 공개 정보는 누구나 읽을 수 있습니다.
    // (단, 쓰기는 아무나 할 수 없도록 막아서 데이터를 보호합니다.)
    match /products/{productId} {
      allow read: if true;
      allow write: if request.auth != null; // 로그인한 사용자는 상품 추가/수정 가능
    }
    match /banners/{bannerId} {
      allow read: if true;
      allow write: if request.auth != null; // 로그인한 사용자는 배너 추가/수정 가능
    }
    match /categories/{categoryId} {
      allow read: if true;
      allow write: if request.auth != null;
    }

    // 사용자는 자신의 정보(users/{userId})만 읽고 쓸 수 있습니다.
    match /users/{userId}/{documents=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // 주문은 생성한 사용자 본인만 읽거나 생성할 수 있습니다.
    match /orders/{orderId} {
      allow read: if request.auth.uid == resource.data.userId;
      allow create: if request.auth.uid == request.resource.data.userId;
      // 수정/삭제는 더 복잡한 규칙이 필요하므로 일단 막습니다.
      allow update, delete: if false;
    }
  }
}