import{j as s,L,r as x,V as b,ah as U,ai as R,aB as z,S as F}from"./index-BMz7zIRN.js";import{u as Q,r as K,f as G,s as H,a as A}from"./orderService-Bzti28Gn.js";import{f as V}from"./formatUtils-C7pUNVKC.js";import{c as w}from"./createLucideIcon-Df3tO_ja.js";import{U as O,M as W,P as B}from"./user-B2WtjEKL.js";import{S as X}from"./shield-x-DqlWjWof.js";import{S as Y,a as J,G as Z,C as ss}from"./sparkles-CiURa8Z7.js";import{f as es}from"./number-D3CZtsVU.js";import{C as ts}from"./circle-plus-DMyLxw0U.js";import{C as as}from"./circle-check-big-B897TBEZ.js";import{C as ns}from"./circle-x-fkkSg6hU.js";import{T as cs}from"./trash-2-C0X2zetg.js";import{D as is}from"./dollar-sign-DcMg-NJE.js";import{S as os}from"./shield-DCKi_qae.js";import{S as T}from"./save-B2IXE8Sx.js";import{T as rs}from"./triangle-alert-DUarG1oM.js";import{f as ls,k as ds}from"./ko-rCIX9F0R.js";import{m as us,A as ms}from"./proxy-CA4nXXUX.js";import{A as ps}from"./arrow-left-Brk6UMhG.js";import{S as $}from"./search-C7k3Fw0J.js";import{X as hs}from"./x-BfIBbJBP.js";import{U as _}from"./users-L5EP99wQ.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],js=w("chart-column",xs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}]],fs=w("circle-minus",Ns);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["line",{x1:"3",x2:"9",y1:"12",y2:"12",key:"1dyftd"}],["line",{x1:"15",x2:"21",y1:"12",y2:"12",key:"oup4p8"}]],ys=w("git-commit-horizontal",gs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],ks=w("rotate-ccw",bs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=[["path",{d:"m13.5 8.5-5 5",key:"1cs55j"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],vs=w("search-slash",Cs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Ps=w("square-check-big",Ss);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],Ds=w("undo-2",ws),Es=a=>{switch(a){case"공구의 신":return{icon:s.jsx(ss,{size:24}),className:"tier-god"};case"공구왕":return{icon:s.jsx(Z,{size:24}),className:"tier-king"};case"공구요정":return{icon:s.jsx(J,{size:24}),className:"tier-fairy"};case"공구새싹":return{icon:s.jsx("i",{className:"seedling-icon-summary",children:"🌱"}),className:"tier-sprout"};case"주의 요망":return{icon:s.jsx(Y,{size:24}),className:"tier-warning"};case"참여 제한":return{icon:s.jsx(X,{size:24}),className:"tier-restricted"};default:return{icon:s.jsx("i",{className:"seedling-icon-summary",children:"🌱"}),className:"tier-sprout"}}},qs=({user:a})=>{const{loyaltyTier:l="공구새싹",pickupCount:d=0,noShowCount:u=0}=a,c=Es(l),m=d+u,p=m>0?d/m*100:0;return s.jsxs("div",{className:`cps-card ${c.className}`,children:[s.jsxs("div",{className:"cps-card-header",children:[s.jsx("div",{className:"cps-tier-icon",children:c.icon}),s.jsxs("div",{className:"cps-tier-info",children:[s.jsx("span",{className:"cps-tier-name",children:l}),s.jsxs("h3",{className:"cps-user-name",children:[a.displayName,a.nickname&&` (${a.nickname})`]})]})]}),s.jsxs("div",{className:"cps-section",children:[s.jsxs("h4",{className:"cps-section-title",children:[s.jsx(js,{size:16}),"주요 통계"]}),s.jsxs("div",{className:"cps-stats-grid",children:[s.jsxs("div",{className:"cps-grid-item",children:[s.jsx("span",{children:"픽업"}),s.jsxs("strong",{className:"text-success",children:[d,"건"]})]}),s.jsxs("div",{className:"cps-grid-item",children:[s.jsx("span",{children:"노쇼"}),s.jsxs("strong",{className:"text-danger",children:[u,"회"]})]}),s.jsxs("div",{className:"cps-grid-item",children:[s.jsx("span",{children:"픽업률"}),s.jsxs("strong",{className:"text-primary",children:[p.toFixed(1),"%"]})]}),s.jsxs("div",{className:"cps-grid-item",children:[s.jsx("span",{children:"신뢰도 포인트"}),s.jsxs("strong",{className:"text-points",children:[(a.points||0).toLocaleString()," P"]})]})]})]}),s.jsxs("div",{className:"cps-section",children:[s.jsxs("h4",{className:"cps-section-title",children:[s.jsx(O,{size:16}),"연락처 정보"]}),s.jsxs("div",{className:"cps-info-item",children:[s.jsxs("span",{className:"cps-info-label",children:[s.jsx(W,{size:14}),"이메일"]}),s.jsx("span",{className:"cps-info-value",children:a.email||"정보 없음"})]}),s.jsxs("div",{className:"cps-info-item",children:[s.jsxs("span",{className:"cps-info-label",children:[s.jsx(B,{size:14}),"연락처"]}),s.jsx("span",{className:"cps-info-value",children:V(a.phone)})]})]}),s.jsx("div",{className:"cps-card-footer",children:s.jsxs(L,{to:`/admin/users/${a.uid}`,className:"cps-detail-link",children:[s.jsx(O,{size:16}),s.jsx("span",{children:"상세 정보 및 전체 관리 페이지로 이동"})]})})]})},Ms=({item:a,totalQuantity:l,onUpdateQuantity:d})=>{const[u,c]=x.useState(!1),[m,p]=x.useState(String(l));x.useEffect(()=>{p(String(l))},[l]);const f=()=>{c(!1);const o=parseInt(m,10);if(isNaN(o)||o<=0){b.error("유효한 수량을 입력해주세요."),p(String(l)),d(l);return}o!==l&&d(o)},h=o=>{o.stopPropagation(),c(!0)},j=(o,C)=>{o.stopPropagation();const v=Math.max(1,parseInt(m||"0",10)+C);p(String(v))},N=o=>{o.stopPropagation()},g=o=>{let C=o.productName||"";return o.variantGroupName&&o.variantGroupName!==o.productName&&(C+=` - ${o.variantGroupName}`),o.itemName&&(C+=` (${o.itemName})`),C};return s.jsxs("div",{className:"qco-item",onClick:o=>o.stopPropagation(),children:[s.jsx("span",{className:"qco-item-name",title:g(a),children:g(a)}),u?s.jsxs("div",{className:"qco-qty-editor",onClick:N,children:[s.jsx("button",{type:"button",onClick:o=>j(o,-1),children:s.jsx(fs,{size:18})}),s.jsx("input",{type:"number",className:"qco-qty-input",value:m,onChange:o=>p(o.target.value),onBlur:f,onKeyDown:o=>{o.key==="Enter"&&o.target.blur(),o.key==="Escape"&&(c(!1),p(String(l)))},autoFocus:!0}),s.jsx("button",{type:"button",onClick:o=>j(o,1),children:s.jsx(ts,{size:18})})]}):s.jsxs("span",{className:"qco-item-qty",onClick:h,title:"수량 클릭하여 수정",children:[l,"개"]})]})},Is=({group:a,onSelect:l,isSelected:d,onQuantityChange:u})=>{const{groupKey:c,status:m,item:p,totalPrice:f,customerInfo:h,pickupDate:j,pickupDeadlineDate:N,totalQuantity:g}=a,o=k=>{if(!k)return"미지정";let i;if(typeof k.toDate=="function")i=k.toDate();else if(typeof k.seconds=="number")i=new Date(k.seconds*1e3);else return"형식 오류";if(isNaN(i.getTime()))return"날짜 오류";const t=String(i.getMonth()+1).padStart(2,"0"),e=String(i.getDate()).padStart(2,"0"),n=["일","월","화","수","목","금","토"][i.getDay()];return`${t}/${e}(${n})`},C=(k,i)=>{const t=r=>r?typeof r.toDate=="function"?r.toDate():typeof r.seconds=="number"?new Date(r.seconds*1e3):null:null,e=t(k),n=t(i);return!e||!n?!1:e.getFullYear()===n.getFullYear()&&e.getMonth()===n.getMonth()&&e.getDate()===n.getDate()},v=k=>{switch(k){case"PICKED_UP":return"bg-picked-up-strong";case"PREPAID":return"bg-prepaid-strong";case"NO_SHOW":return"bg-noshow-strong";case"CANCELED":return"bg-canceled";default:return"bg-default"}},S=j,D=N??j,E=C(S,D),q=k=>{u(a,k)};return s.jsxs("div",{className:`qc-order-card ${d?"selected":""} ${v(m)}`,onClick:()=>l(c),children:[d&&s.jsx("div",{className:"qco-checkmark",children:s.jsx(Ps,{size:24})}),s.jsx("div",{className:"qco-top-row",children:E?s.jsxs("span",{className:"today",children:["🔥 ",o(S)," 당일픽업"]}):s.jsxs(s.Fragment,{children:[s.jsxs("span",{children:[o(S)," 입고"]}),s.jsxs("span",{children:[o(D)," 마감"]})]})}),s.jsx("div",{className:"qco-body",children:s.jsx(Ms,{item:p,totalQuantity:g,onUpdateQuantity:q})}),s.jsxs("div",{className:"qco-bottom-row",children:[s.jsx("span",{className:"qco-customer-name",title:`전화번호: ${h.phone}`,children:h.name}),s.jsxs("span",{className:"qco-total-price",children:[es(f),"원"]})]})]})},I=async(a,l,d,u,c)=>{l();const m=b.loading(c.loading);try{await a(),b.success(c.success,{id:m}),u()}catch(p){d(),b.error(p.message||c.error,{id:m})}},zs=({orders:a=[],onStatusChange:l})=>{const d=x.useMemo(()=>[...a].sort((c,m)=>m.createdAt.toMillis()-c.createdAt.toMillis()),[a]),u={RESERVED:{label:"예약",className:"status-reserved"},PREPAID:{label:"선입금",className:"status-prepaid"},PICKED_UP:{label:"픽업완료",className:"status-picked-up"},COMPLETED:{label:"처리완료",className:"status-picked-up"},CANCELED:{label:"취소",className:"status-canceled"},NO_SHOW:{label:"노쇼",className:"status-no-show"}};return s.jsx("div",{className:"order-table-container",children:a.length>0?s.jsx("div",{className:"table-responsive",children:s.jsxs("table",{className:"data-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"예약일"}),s.jsx("th",{children:"상품 정보"}),s.jsx("th",{children:"금액"}),s.jsx("th",{children:"상태"})]})}),s.jsx("tbody",{children:d.map(c=>{const m=["PICKED_UP","NO_SHOW","CANCELED"].includes(c.status);return s.jsxs("tr",{className:`status-row-${c.status}`,children:[s.jsx("td",{children:ls(c.createdAt.toDate(),"M/d(eee)",{locale:ds})}),s.jsx("td",{children:c.items.map(p=>`${p.productName} (${p.quantity}개)`).join(", ")}),s.jsxs("td",{children:[(c.totalPrice||0).toLocaleString(),"원"]}),s.jsx("td",{className:"status-cell",children:s.jsx("div",{className:"status-cell-content",children:m?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:`status-badge ${u[c.status]?.className||""}`,children:u[c.status]?.label}),c.status!=="CANCELED"&&s.jsxs("button",{onClick:()=>l(c),className:"revert-button",title:"이전 상태로 되돌리기",children:[s.jsx(Ds,{size:14})," 되돌리기"]})]}):s.jsx("span",{className:`status-badge ${u[c.status]?.className||""}`,children:u[c.status]?.label})})})]},c.id)})})]})}):s.jsx("p",{className:"no-data-message",children:"주문 내역이 없습니다."})})},As=({user:a})=>{const[l,d]=x.useState(a.pickupCount||0),[u,c]=x.useState(a.noShowCount||0),[m,p]=x.useState(a.manualTier||"auto");x.useEffect(()=>{d(a.pickupCount||0),c(a.noShowCount||0),p(a.manualTier||"auto")},[a]);const f=()=>{const j=R(a.uid,l,u);b.promise(j,{loading:"저장 중...",success:"저장 완료",error:"저장 실패"})},h=()=>{const j=m==="auto"?null:m,N=U(a.uid,j);b.promise(N,{loading:"적용 중...",success:"적용 완료",error:"적용 실패"})};return s.jsxs("div",{className:"trust-management-container",children:[s.jsxs("div",{className:"management-section",children:[s.jsxs("h3",{children:[s.jsx(os,{size:20}),"신뢰도 관리"]}),s.jsx("h4",{children:"등급 직접 지정 (구제용)"}),s.jsx("p",{className:"description",children:a.manualTier?s.jsxs(s.Fragment,{children:["현재 ",s.jsx("strong",{style:{color:"var(--accent-color)"},children:a.manualTier})," 등급으로 수동 설정되어 있습니다."]}):"현재 픽업/노쇼 횟수에 따라 자동 계산됩니다."}),s.jsxs("div",{className:"role-form",children:[s.jsxs("select",{value:m,onChange:j=>p(j.target.value),children:[s.jsx("option",{value:"auto",children:"자동 계산"}),s.jsx("option",{value:"공구의 신",children:"공구의 신"}),s.jsx("option",{value:"공구왕",children:"공구왕"}),s.jsx("option",{value:"공구요정",children:"공구요정"}),s.jsx("option",{value:"공구새싹",children:"공구새싹"}),s.jsx("option",{value:"주의 요망",children:"주의 요망"}),s.jsx("option",{value:"참여 제한",children:"참여 제한"})]}),s.jsxs("button",{onClick:h,className:"common-button button-primary button-small",children:[s.jsx(T,{size:14})," 등급 적용"]})]})]}),s.jsx("hr",{className:"divider"}),s.jsxs("div",{className:"management-section",children:[s.jsx("h4",{children:"픽업/노쇼 횟수 조정 (데이터 보정용)"}),s.jsxs("div",{className:"counts-form",children:[s.jsxs("div",{className:"form-group-inline",children:[s.jsx("label",{children:"픽업 완료"}),s.jsx("input",{type:"number",value:l,onChange:j=>d(Number(j.target.value))})]}),s.jsxs("div",{className:"form-group-inline",children:[s.jsx("label",{children:"노쇼"}),s.jsx("input",{type:"number",value:u,onChange:j=>c(Number(j.target.value))})]}),s.jsxs("button",{onClick:f,className:"common-button button-secondary button-small",children:[s.jsx(T,{size:14})," 횟수 저장"]})]}),s.jsxs("div",{className:"warning-box",children:[s.jsx(rs,{size:16}),s.jsxs("span",{children:[s.jsx("strong",{children:"주의:"})," 데이터 오류 수정이 필요한 명확한 경우에만 사용하세요."]})]})]})]})},Os=({user:a,orders:l=[],onStatUpdate:d,onActionSuccess:u})=>{const[c,m]=x.useState("pickup"),[p,f]=x.useState([]),[h,j]=x.useState(null),N=x.useMemo(()=>{const i=l.filter(e=>e.status==="RESERVED"||e.status==="PREPAID"),t=new Map;return i.forEach(e=>{e.items.forEach(n=>{const r=`${e.userId}-${n.productId}-${n.itemId}-${e.status}`;if(t.has(r)){const y=t.get(r);y.totalQuantity+=n.quantity,y.totalPrice+=n.unitPrice*n.quantity,y.originalOrders.push({orderId:e.id,quantity:n.quantity,status:e.status})}else t.set(r,{groupKey:r,customerInfo:e.customerInfo,item:n,totalQuantity:n.quantity,totalPrice:n.unitPrice*n.quantity,status:e.status,pickupDate:e.pickupDate,pickupDeadlineDate:e.pickupDeadlineDate,originalOrders:[{orderId:e.id,quantity:n.quantity,status:e.status}]})})}),Array.from(t.values())},[l]),g=x.useMemo(()=>N.filter(i=>p.includes(i.groupKey)),[N,p]),o=i=>{if(h){b.error("수량 변경 후에는 먼저 분할 처리를 완료해주세요.");return}f(t=>t.includes(i)?t.filter(e=>e!==i):[...t,i])},C=(i,t)=>{if(t!==i.totalQuantity){if(i.originalOrders.length>1){b.error("묶인 그룹의 수량은 변경할 수 없습니다.");return}j({group:i,newQuantity:t}),f([i.groupKey])}else j(null),f([])},v=i=>{if(p.length===0)return;const t=g.flatMap(y=>y.originalOrders.map(P=>P.orderId)),e=g.reduce((y,P)=>y+P.totalPrice,0),n={},r={loading:"상태 변경 중...",success:"상태가 변경되었습니다.",error:"상태 변경 실패"};if(i==="PICKED_UP"){const y=Math.floor(e*.005);n.pickup=1,n.points=y,r.success=`픽업 완료! ${y}P 적립.`}if(i==="CANCELED"||i==="NO_SHOW"){const M=-50+-Math.floor(e*.05);n.noshow=1,n.points=M,r.success=`처리 완료! ${M}P 차감.`}I(()=>Q(t,i),()=>d(n),()=>d({pickup:-(n.pickup||0),noshow:-(n.noshow||0),points:-(n.points||0)}),u,r)},S=i=>{const t=i.status,e=i.totalPrice,n={};if(t==="PICKED_UP"){const r=-Math.floor(e*.005);n.pickup=-1,n.points=r}if(t==="CANCELED"||t==="NO_SHOW"){const P=50+Math.floor(e*.05);n.noshow=-1,n.points=P}I(()=>K([i.id],t),()=>d(n),()=>d({pickup:-(n.pickup||0),noshow:-(n.noshow||0),points:-(n.points||0)}),u,{loading:"상태를 되돌리는 중...",success:"예약 상태로 되돌렸습니다.",error:"되돌리기에 실패했습니다."})},D=()=>{if(p.length===0)return;const i=g.flatMap(t=>t.originalOrders.map(e=>e.orderId));I(()=>G(i),()=>{},()=>{},u,{loading:"주문 삭제 중...",success:"삭제되었습니다.",error:"삭제 실패"})},E=()=>{if(!h)return;const i=t=>{const e=h.group.originalOrders[0].orderId,r={pickup:1,points:Math.floor(h.group.item.unitPrice*h.newQuantity*.005)};if(t==="NO_SHOW"){const y=-50-Math.floor((h.group.totalPrice-h.group.item.unitPrice*h.newQuantity)*.05);r.noshow=1,r.points=(r.points||0)+y}I(()=>H(e,h.newQuantity,t),()=>d(r),()=>d({pickup:-(r.pickup||0),noshow:-(r.noshow||0),points:-(r.points||0)}),u,{loading:"분할 처리 중...",success:"분할 처리가 완료되었습니다.",error:"분할 처리 실패"})};b.custom(t=>s.jsxs("div",{className:"confirmation-toast",children:[s.jsx("h4",{children:"분할 처리 확인"}),s.jsxs("p",{children:[s.jsxs("strong",{children:[h.newQuantity,"개"]}),"를 픽업 처리하고,",s.jsx("br",{}),"남은 ",s.jsxs("strong",{children:[h.group.totalQuantity-h.newQuantity,"개"]}),"는 어떻게 할까요?"]}),s.jsxs("div",{className:"toast-buttons",children:[s.jsx("button",{className:"common-button button-danger button-medium",onClick:()=>{b.dismiss(t.id),i("NO_SHOW")},children:"노쇼 처리"}),s.jsx("button",{className:"common-button button-secondary button-medium",onClick:()=>{b.dismiss(t.id),i("RESERVED")},children:"예약 유지"}),s.jsx("button",{className:"common-button button-light button-medium",onClick:()=>b.dismiss(t.id),children:"취소"})]})]}),{duration:1/0,position:"top-center"})},q=()=>{switch(c){case"pickup":return s.jsxs("div",{className:"qcp-results-grid",children:[N.map(i=>s.jsx(Is,{group:i,isSelected:p.includes(i.groupKey),onSelect:o,onQuantityChange:C},i.groupKey)),N.length===0&&s.jsx("p",{className:"no-data-message",children:"처리 대기중인 항목이 없습니다."})]});case"history":return s.jsx(zs,{orders:l,onStatusChange:S});case"manage":return s.jsx(As,{user:a});default:return null}},k=()=>{if(c!=="pickup"||p.length===0)return null;const i=g.reduce((n,r)=>n+r.totalPrice,0);if(h)return s.jsxs("div",{className:"cat-action-footer",children:[s.jsxs("span",{className:"cat-footer-summary",children:[h.group.item.productName,": ",h.group.totalQuantity,"개 중 ",h.newQuantity,"개"]}),s.jsx("div",{className:"cat-footer-actions",children:s.jsxs("button",{onClick:E,className:"common-button button-pickup",children:[s.jsx(ys,{size:16})," 분할 픽업"]})})]});const e=g.length>0&&g.every(n=>n.status==="PREPAID")?s.jsxs("button",{onClick:()=>v("RESERVED"),className:"common-button button-prepaid-cancel",children:[s.jsx(ks,{size:16})," 선입금 취소"]}):s.jsxs("button",{onClick:()=>v("PREPAID"),className:"common-button button-prepaid",children:[s.jsx(is,{size:16})," 선입금"]});return s.jsxs("div",{className:"cat-action-footer",children:[s.jsxs("span",{className:"cat-footer-summary",children:[p.length,"건 선택 / ",i.toLocaleString(),"원"]}),s.jsxs("div",{className:"cat-footer-actions",children:[s.jsxs("button",{onClick:()=>v("PICKED_UP"),className:"common-button button-pickup",children:[s.jsx(as,{size:20})," 픽업"]}),e,s.jsxs("button",{onClick:()=>v("CANCELED"),className:"common-button button-cancel",children:[s.jsx(ns,{size:16})," 취소"]}),s.jsxs("button",{onClick:D,className:"common-button button-dark",children:[s.jsx(cs,{size:16})," 삭제"]})]})]})};return s.jsxs("div",{className:"cat-container",children:[s.jsxs("div",{className:"cat-tab-navigation",children:[s.jsxs("button",{className:c==="pickup"?"active":"",onClick:()=>m("pickup"),children:["픽업 카드 (",N.length,")"]}),s.jsxs("button",{className:c==="history"?"active":"",onClick:()=>m("history"),children:["전체 주문 내역 (",l.length,")"]}),s.jsx("button",{className:c==="manage"?"active":"",onClick:()=>m("manage"),children:"신뢰도 관리"})]}),s.jsx("div",{className:`cat-tab-content ${c==="pickup"?"is-grid-view":""}`,children:q()}),k()]})},Ts=({user:a,orders:l,onBack:d,onStatUpdate:u,onActionSuccess:c})=>s.jsxs(us.div,{className:"cfv-container",initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.98},transition:{duration:.3},children:[s.jsx("div",{className:"cfv-header",children:s.jsxs("button",{onClick:d,className:"cfv-back-button",children:[s.jsx(ps,{size:20}),s.jsx("span",{children:"전체 검색으로 돌아가기"})]})}),s.jsxs("div",{className:"cfv-body",children:[s.jsx("aside",{className:"cfv-left-column",children:s.jsx(qs,{user:a})}),s.jsx("main",{className:"cfv-right-column",children:s.jsx(Os,{user:a,orders:l,onStatUpdate:u,onActionSuccess:c})})]})]}),$s=({user:a,onSelect:l})=>s.jsxs("button",{className:"user-search-result-item",onClick:()=>l(a),children:[s.jsxs("div",{className:"user-info",children:[s.jsx("span",{className:"user-name",children:a.displayName}),s.jsx("span",{className:"user-phone",children:a.phone||"전화번호 미등록"})]}),s.jsx("div",{className:"user-tier",children:s.jsx("span",{children:a.loyaltyTier})})]}),ie=()=>{const[a,l]=x.useState(""),[d,u]=x.useState(!0),[c,m]=x.useState(null),[p,f]=x.useState([]),[h,j]=x.useState(!1),[N,g]=x.useState([]),[o,C]=x.useState([]);x.useEffect(()=>{(async()=>{try{const e=await z();C(e)}catch{b.error("전체 사용자 목록을 불러오는 데 실패했습니다.")}finally{u(!1)}})()},[]);const v=t=>{t?.preventDefault();const e=a.trim();if(e.length<2){b.error("검색어는 2자 이상 입력해주세요.");return}u(!0),j(!0),m(null),g([]),f([]);const n=o.filter(r=>{const y=e.toLowerCase(),P=r.displayName?.toLowerCase().includes(y),M=r.phoneLast4&&r.phoneLast4.endsWith(e);return P||M});n.length===0||(n.length===1?S(n[0]):g(n)),setTimeout(()=>u(!1),200)},S=x.useCallback(async t=>{u(!0),g([]),m(t);try{const e=await A(t.uid);f(e)}catch{b.error("사용자의 주문 내역을 불러오지 못했습니다."),f([])}finally{u(!1)}},[]),D=x.useCallback(t=>{m(e=>e?{...e,pickupCount:Math.max(0,(e.pickupCount||0)+(t.pickup||0)),noShowCount:Math.max(0,(e.noShowCount||0)+(t.noshow||0)),points:(e.points||0)+(t.points||0)}:null)},[]),E=x.useCallback(async()=>{if(c){u(!0);try{const t=await A(c.uid);f(t);const e=await z();C(e);const n=e.find(r=>r.uid===c.uid);n&&m(n)}catch{b.error("데이터를 새로고침하지 못했습니다.")}finally{u(!1)}}},[c]),q=()=>{m(null),f([])},k=()=>{l(""),j(!1),g([]),m(null),f([])};x.useEffect(()=>{N.length>0&&m(null)},[N]);const i=h&&!d&&!c&&N.length===0;return s.jsxs("div",{className:"quick-check-page",children:[s.jsx("header",{className:"qcp-header",children:s.jsx("h1",{children:"빠른 예약 확인"})}),s.jsx("div",{className:"qcp-search-container",children:s.jsxs("form",{onSubmit:v,className:"qcp-search-form",children:[s.jsxs("div",{className:"qcp-input-wrapper",children:[s.jsx($,{className:"qcp-input-icon",size:18}),s.jsx("input",{type:"text",value:a,onChange:t=>l(t.target.value),placeholder:"고객 이름 또는 전화번호 뒷 4자리",className:"qcp-input"}),a&&s.jsx(hs,{className:"qcp-clear-icon",size:18,onClick:k})]}),s.jsxs("button",{type:"submit",className:"qcp-search-button",disabled:d,children:[s.jsx($,{size:16}),s.jsx("span",{children:"검색"})]})]})}),s.jsxs(ms,{mode:"wait",children:[d&&s.jsx(F,{message:"사용자 목록을 불러오는 중..."}),!d&&c&&s.jsx(Ts,{user:c,orders:p,onBack:q,onStatUpdate:D,onActionSuccess:E}),!d&&!c&&s.jsx("div",{className:"qcp-results-container",children:N.length>0?s.jsxs("div",{className:"disambiguation-box",children:[s.jsxs("h3",{children:[s.jsx(_,{size:16}),"여러분이 검색되었습니다. 선택해주세요."]}),N.map(t=>s.jsx($s,{user:t,onSelect:S},t.uid))]}):i?s.jsxs("div",{className:"qcp-initial-prompt",children:[s.jsx(vs,{size:48,className:"prompt-icon"}),s.jsxs("p",{children:["'",a,"'에 대한 검색 결과가 없습니다.",s.jsx("br",{}),"이름 또는 전화번호를 다시 확인해주세요."]})]}):!h&&s.jsxs("div",{className:"qcp-initial-prompt",children:[s.jsx(_,{size:48,className:"prompt-icon"}),s.jsxs("p",{children:["고객의 이름 또는 전화번호 뒷 4자리를 검색하여",s.jsx("br",{}),"예약 내역을 빠르게 확인하고 처리하세요."]})]})})]})]})};export{ie as default};
