import{w as h,T as D}from"./index-BMz7zIRN.js";import{d as p}from"./dayjs.min-B5lyAaGD.js";import{i as E}from"./isBetween-CLbg94Zy.js";var m={exports:{}},T=m.exports,S;function k(){return S||(S=1,function(t,i){(function(r,o){t.exports=o()})(T,function(){return function(r,o){o.prototype.isSameOrAfter=function(s,e){return this.isSame(s,e)||this.isAfter(s,e)}}})}(m)),m.exports}var v=k();const B=h(v);p.extend(E);p.extend(B);const a=t=>{if(!t)return null;if(t instanceof Date)return t;if(typeof t.toDate=="function")return t.toDate();if(typeof t=="object"&&(t._seconds!==void 0||t.seconds!==void 0)){const i=t.seconds??t._seconds,r=t.nanoseconds??t._nanoseconds??0;return new D(i,r).toDate()}if(typeof t=="string"){const i=new Date(t);if(!isNaN(i.getTime()))return i}return console.warn("Unsupported date format:",t),null},I=t=>{const i=a(t.publishAt),r=a(t.pickupDate);let o=null;if(i){let e=p(i);const n=e.day();n===6?e=e.add(2,"day"):e=e.add(1,"day"),o=e.hour(13).minute(0).second(0).millisecond(0).toDate()}else o=a(t.deadlineDate);const s=r?p(r).hour(13).minute(0).second(0).toDate():null;return{primaryEnd:o,secondaryEnd:s}},L=t=>{if(!t.salesHistory||t.salesHistory.length===0)return null;const i=p(),r=s=>{const e=a(s.publishAt);return s.status==="selling"?1:s.status==="scheduled"&&e&&i.isSameOrAfter(e)?2:s.status==="scheduled"&&e&&i.isBefore(e)?3:s.status==="ended"||s.status==="sold_out"?4:5};return[...t.salesHistory].filter(s=>s.status!=="draft").sort((s,e)=>{const n=r(s),u=r(e);if(n!==u)return n-u;switch(n){case 1:case 2:return(a(e.createdAt)?.getTime()??0)-(a(s.createdAt)?.getTime()??0);case 3:return(a(s.publishAt)?.getTime()??0)-(a(e.publishAt)?.getTime()??0);case 4:return(a(e.deadlineDate)?.getTime()??0)-(a(s.deadlineDate)?.getTime()??0);default:return(a(e.createdAt)?.getTime()??0)-(a(s.createdAt)?.getTime()??0)}})[0]||null},R=(t,i,r)=>{const o=i?.loyaltyTier,s=t.allowedTiers||[];if(s.length>0&&(!o||!s.includes(o)))return"INELIGIBLE";const e=p(),{primaryEnd:n,secondaryEnd:u}=I(t);if(t.status==="scheduled"){const c=a(t.publishAt);if(c&&e.isBefore(c))return"SCHEDULED"}const d=t.variantGroups.length>1||(t.variantGroups[0]?.items.length||0)>1;if(n&&e.isBefore(n)){if(d&&!r)return"REQUIRE_OPTION";let c=!1;if(r){const l=r.totalPhysicalStock;if(l!==null&&l!==-1){const f=r.reservedCount||0;l-f<=0&&(c=!0)}}return c?"WAITLISTABLE":"PURCHASABLE"}if(u&&n&&e.isBetween(n,u,null,"[]")){if(d&&!r)return"REQUIRE_OPTION";if(!(r?r.totalPhysicalStock!==null&&r.totalPhysicalStock!==-1:!1))return"AWAITING_STOCK";let l=!1;if(r){const f=r.reservedCount||0;(r.totalPhysicalStock||0)-f<=0&&(l=!0)}return l?"WAITLISTABLE":"PURCHASABLE"}return t.status==="ended"||t.status==="sold_out"?"ENCORE_REQUESTABLE":"ENDED"},w=(t,i)=>{const r=t.displayRound,o=i.displayRound,s=r.variantGroups?.[0],e=o.variantGroups?.[0],n=s?.items?.[0],u=e?.items?.[0];if(!s||!n)return 1;if(!e||!u)return-1;const d=s.totalPhysicalStock!==null&&s.totalPhysicalStock!==-1,c=d?(s.totalPhysicalStock||0)-(s.reservedCount||0):1/0,l=n.price,f=e.totalPhysicalStock!==null&&e.totalPhysicalStock!==-1,y=f?(e.totalPhysicalStock||0)-(e.reservedCount||0):1/0,A=u.price;return d&&!f?-1:!d&&f?1:d&&f&&c!==y?c-y:l!==A?A-l:0};export{I as a,w as b,R as d,L as g,a as s};
