import{b as f,r as d,j as e,V as l,z as T,h as w,u,A as P,B as L,C as R,D as _}from"./index-BMz7zIRN.js";import{I as O}from"./InlineSodomallLoader-CN_E-RXV.js";import{G as N,U as $}from"./user-plus-DMCucGJt.js";import{I as y}from"./info-DxE8bBlt.js";import{c as v}from"./createLucideIcon-Df3tO_ja.js";import{S as k}from"./shield-DCKi_qae.js";import{T as G}from"./trending-up-BeywEaFl.js";import{C as b}from"./chevron-right-BbSiuQEu.js";import{A,m as j}from"./proxy-CA4nXXUX.js";import{X as U}from"./x-BfIBbJBP.js";import{M as g}from"./index-CDTLh11W.js";import{S as C}from"./shield-x-DqlWjWof.js";import{S as M,a as z,G as S,C as I}from"./sparkles-CiURa8Z7.js";import{C as F}from"./chart-no-axes-column-CffmgICP.js";import{C as E}from"./calendar-B4F1rzMj.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],B=v("copy",V);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],W=v("log-out",H),X=()=>{const{user:s}=f(),[a,t]=d.useState(""),[i,r]=d.useState(!1),o=async()=>{if(!s){l.error("로그인 정보가 유효하지 않습니다.");return}if(!a.trim()){l.error("초대 코드를 입력해주세요.");return}r(!0);const n=T(a.trim().toUpperCase());l.promise(n,{loading:"코드를 확인하는 중...",success:c=>String(c),error:c=>c.message||"코드 적용에 실패했습니다. 다시 확인해주세요."});try{await n}catch(c){console.error("Referral code submission failed:",c)}finally{r(!1)}};return e.jsxs("div",{className:"referral-input-card","data-tutorial-id":"mypage-referral-input",children:[e.jsxs("div",{className:"referral-input-header",children:[e.jsx(N,{size:24}),e.jsx("h4",{children:"친구 초대 코드 입력"})]}),e.jsxs("p",{className:"referral-input-guide",children:[e.jsx(y,{size:14}),e.jsxs("span",{className:"guide-text",children:["초대 코드를 입력하고 즉시 ",e.jsx("strong",{children:"30포인트"}),"를 받으세요! (최초 1회)"]})]}),e.jsxs("div",{className:"referral-input-form",children:[e.jsx("input",{type:"text",value:a,onChange:n=>t(n.target.value.toUpperCase()),placeholder:"친구에게 받은 초대 코드",disabled:i}),e.jsx("button",{onClick:o,className:"common-button button-primary",disabled:i,children:i?"확인 중...":"포인트 받기"})]})]})},K=s=>{switch(s){case"공구의 신":return{tierName:"공구의 신",icon:e.jsx(I,{size:24})};case"공구왕":return{tierName:"공구왕",icon:e.jsx(S,{size:24})};case"공구요정":return{tierName:"공구요정",icon:e.jsx(z,{size:24})};case"공구새싹":return{tierName:"공구새싹",icon:e.jsx("i",{className:"seedling-icon-mypage",children:"🌱"})};case"주의 요망":return{tierName:"주의 요망",icon:e.jsx(M,{size:24})};case"참여 제한":return{tierName:"참여 제한",icon:e.jsx(C,{size:24})};default:return{tierName:"공구새싹",icon:e.jsx("i",{className:"seedling-icon-mypage",children:"🌱"})}}},q=(s,a,t)=>{const i=a+t,r=i>0?Math.round(a/i*100):0;if(s==="참여 제한")return{currentRate:r,progressMessage:"누적 노쇼 3회 이상으로 참여가 제한되었습니다."};if(i===0)return{currentRate:0,progressMessage:"첫 픽업 완료 시 등급이 산정됩니다."};switch(s){case"주의 요망":const o=Math.max(0,Math.ceil(t*7/3-a));return{currentRate:r,progressMessage:`'공구새싹'으로 복귀하려면 약 ${o}회의 추가 픽업이 필요해요.`};case"공구새싹":const n=Math.max(0,30-a);return{currentRate:r,progressMessage:`다음 등급 '공구요정'까지 픽업 ${n}회 남았습니다. (픽업 30회 & 픽업률 90%↑)`};case"공구요정":const c=Math.max(0,100-a);return{currentRate:r,progressMessage:`다음 등급 '공구왕'까지 픽업 ${c}회 남았습니다. (픽업 100회 & 픽업률 95%↑)`};case"공구왕":const m=Math.max(0,250-a);return{currentRate:r,progressMessage:`다음 등급 '공구의 신'까지 픽업 ${m}회 남았습니다. (픽업 250회 & 픽업률 98%↑)`};case"공구의 신":return{currentRate:r,progressMessage:"최고 등급 '공구의 신'입니다! 언제나 감사드립니다. 💖"};default:return{currentRate:r,progressMessage:"성실한 픽업으로 등급을 올려보세요!"}}},p=s=>{switch(s){case"공구의 신":return"tier-god";case"공구왕":return"tier-king";case"공구요정":return"tier-fairy";case"공구새싹":return"tier-sprout";case"주의 요망":return"tier-warning";case"참여 제한":return"tier-restricted";default:return"tier-default"}},J=({percentage:s,tier:a})=>{const[t,i]=d.useState(0),r=52,o=2*Math.PI*r,n=p(a);return d.useEffect(()=>{const c=(100-s)/100*o;i(c)},[s,o]),e.jsxs("div",{className:"progress-ring-wrapper",children:[e.jsxs("svg",{className:"progress-ring",width:"120",height:"120",children:[e.jsx("circle",{className:"progress-ring__circle-bg",strokeWidth:"8",fill:"transparent",r,cx:"60",cy:"60"}),e.jsx("circle",{className:`progress-ring__circle ${n}`,strokeWidth:"8",fill:"transparent",r,cx:"60",cy:"60",style:{strokeDasharray:o,strokeDashoffset:t}})]}),e.jsxs("div",{className:"progress-ring__text",children:[e.jsxs("span",{className:"percentage",children:[s,"%"]}),e.jsx("span",{className:"label",children:"픽업률"})]})]})},Q=[{tier:"공구의 신",icon:e.jsx(I,{size:24}),criteria:"픽업률 98% 이상 & 누적 픽업 250회 이상"},{tier:"공구왕",icon:e.jsx(S,{size:24}),criteria:"픽업률 95% 이상 & 누적 픽업 100회 이상"},{tier:"공구요정",icon:e.jsx(z,{size:24}),criteria:"픽업률 90% 이상 & 누적 픽업 30회 이상"},{tier:"공구새싹",icon:e.jsx("i",{className:"seedling-icon-mypage",children:"🌱"}),criteria:"픽업률 70% 이상 (첫 픽업 완료 시 달성)"},{tier:"주의 요망",icon:e.jsx(M,{size:24}),criteria:"픽업률 70% 미만"},{tier:"참여 제한",icon:e.jsx(C,{size:24}),criteria:"누적 노쇼 3회 이상 시 즉시 적용"}],Y=({isOpen:s,onClose:a})=>e.jsx(A,{children:s&&e.jsx(j.div,{className:"modal-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:a,children:e.jsxs(j.div,{className:"modal-content tier-guide-modal",initial:{y:50,opacity:0},animate:{y:0,opacity:1},exit:{y:50,opacity:0},transition:{type:"spring",stiffness:300,damping:30},onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h4",{children:"👑 신뢰 등급 안내"}),e.jsx("button",{onClick:a,className:"modal-close-button",children:e.jsx(U,{size:24})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("div",{className:"guide-intro",children:e.jsx(g,{children:"소도몰의 등급은 포인트와 무관하며, 오직 **'픽업 약속 이행'**으로만 결정됩니다.\n\n**'주문 건'**을 기준으로, 1건의 주문을 정상 픽업하면 `픽업 1회`가 기록됩니다. (주문한 상품의 개수와는 무관합니다)"})}),e.jsx("div",{className:"tier-details-list",children:Q.map(r=>e.jsxs("div",{className:`tier-detail-item ${p(r.tier)}`,children:[e.jsxs("div",{className:"tier-detail-icon-name",children:[e.jsx("div",{className:"tier-item-icon",children:r.icon}),e.jsx("div",{className:"tier-item-name",children:r.tier})]}),e.jsx("div",{className:"tier-detail-criteria",children:r.criteria})]},r.tier))}),e.jsx("div",{className:"guide-outro",children:e.jsx(g,{children:"높은 신뢰 등급을 가진 고객님들께는 **'선주문'** 이나 **'시크릿 상품'** 참여 기회처럼 특별한 혜택이 가장 먼저 주어집니다! ✨"})})]})]})})}),Z=({userDocument:s,onTierClick:a})=>{const t=u(),i=d.useMemo(()=>K(s?.loyaltyTier||"공구새싹"),[s?.loyaltyTier]),r=d.useMemo(()=>q(s?.loyaltyTier||"공구새싹",s?.pickupCount||0,s?.noShowCount||0),[s?.loyaltyTier,s?.pickupCount,s?.noShowCount]),o=p(i.tierName),n=s.role==="admin"||s.role==="master",c=n?`role-${s.role}`:o;return e.jsxs("div",{className:`unified-profile-card-v2 ${c}`,children:[e.jsx("div",{className:"card-v2-background"}),e.jsxs("div",{className:"card-v2-content",children:[e.jsxs("div",{className:"profile-tier-section-v2",onClick:a,"data-tutorial-id":"mypage-profile-card",children:[e.jsxs("div",{className:"tier-display",children:[e.jsxs("div",{className:"tier-icon-name",children:[n?e.jsx(k,{size:24}):i.icon,e.jsx("span",{className:"tier-name",children:n?s.role?.toUpperCase():i.tierName})]}),e.jsxs("span",{className:"display-name",children:[s.displayName||"고객","님",s.nickname&&e.jsxs("span",{className:"nickname-display",children:[" (",s.nickname,")"]})]}),e.jsx("p",{className:"progress-message",children:n?"모든 권한을 가지고 있습니다.":r.progressMessage})]}),!n&&e.jsx(J,{percentage:r.currentRate,tier:i.tierName})]}),e.jsxs("div",{className:"profile-points-section-v2",onClick:()=>t("/mypage/points"),children:[e.jsxs("div",{className:"points-label",children:[e.jsx(G,{size:18}),e.jsx("span",{children:"활동 포인트"})]}),e.jsxs("div",{className:"points-value",children:[e.jsxs("span",{children:[(s?.points||0).toLocaleString()," P"]}),e.jsx(b,{size:16,className:"arrow-icon"})]})]})]})]})},D=({userDocument:s})=>{const[a,t]=d.useState(""),[i,r]=d.useState(!1),o=async()=>{if(!a.trim()){l.error("닉네임을 입력해주세요.",{duration:3e3});return}r(!0);const n=L(R,"users",s.uid),c=_(n,{nickname:a.trim(),nicknameChanged:!0});l.promise(c,{loading:"닉네임을 저장하는 중...",success:"닉네임이 성공적으로 설정되었습니다!",error:"닉네임 저장에 실패했습니다. 다시 시도해주세요."},{success:{duration:3e3},error:{duration:3e3}});try{await c}catch{}finally{r(!1)}};return s.nicknameChanged||s.nickname?null:e.jsxs("div",{className:"nickname-setup-card","data-tutorial-id":"mypage-nickname-setup",children:[e.jsxs("div",{className:"nickname-setup-header",children:[e.jsx($,{size:24}),e.jsx("h4",{children:"닉네임 설정 (최초 1회)"})]}),e.jsxs("p",{className:"nickname-setup-guide",children:[e.jsx(y,{size:14}),"카카오톡 오픈채팅방에서 사용하는 닉네임으로 설정하시면 소통이 원활합니다."]}),e.jsxs("div",{className:"nickname-setup-form",children:[e.jsx("input",{type:"text",value:a,onChange:n=>t(n.target.value),placeholder:"사용하실 닉네임을 입력하세요",disabled:i}),e.jsx("button",{onClick:o,className:"common-button button-primary",disabled:i,children:i?"저장 중...":"저장"})]})]})},ee=({referralCode:s})=>{const a=()=>{s&&navigator.clipboard.writeText(s).then(()=>l.success("초대코드가 복사되었습니다!",{duration:3e3})).catch(t=>{l.error("복사에 실패했습니다.",{duration:3e3}),console.error("클립보드 복사 실패:",t)})};return s?e.jsxs("div",{className:"referral-card","data-tutorial-id":"mypage-referral-code",children:[e.jsxs("div",{className:"referral-info",children:[e.jsx("div",{className:"referral-icon",children:e.jsx(N,{size:24})}),e.jsxs("div",{children:[e.jsx("h4",{children:"친구 초대하고 포인트 받기"}),e.jsxs("p",{children:["친구가 내 코드를 입력하고 첫 픽업을 완료하면 ",e.jsx("strong",{children:"30P"}),"가 적립됩니다."]})]})]}),e.jsxs("div",{className:"referral-action",children:[e.jsx("span",{className:"referral-code",children:s}),e.jsxs("button",{onClick:a,className:"copy-button",children:[e.jsx(B,{size:16}),"복사"]})]})]}):null},se=()=>{const s=u(),a=[{icon:e.jsx(F,{size:22,className:"icon-history"}),label:"주문/대기 내역",path:"/mypage/history"},{icon:e.jsx(E,{size:22,className:"icon-calendar"}),label:"픽업 달력",path:"/mypage/orders"},{icon:e.jsx(k,{size:22,className:"icon-encore"}),label:"마감 상품 (앵콜)",path:"/encore"}];return e.jsx("nav",{className:"mypage-menu-list","data-tutorial-id":"mypage-menu-list",children:a.map(t=>e.jsxs("div",{className:"menu-list-item",onClick:()=>s(t.path),children:[e.jsxs("div",{className:"menu-item-content",children:[t.icon,e.jsx("span",{children:t.label})]}),e.jsx(b,{size:20,className:"menu-item-arrow"})]},t.label))})},ge=()=>{const{user:s,userDocument:a,logout:t}=f(),{runPageTourIfFirstTime:i}=w(),r=u(),[o,n]=d.useState(!1);d.useEffect(()=>{a&&i("hasSeenMyPage",P)},[a,i]);const c=d.useCallback(()=>{l(x=>e.jsxs("div",{className:"confirmation-toast",children:[e.jsx("h4",{children:"로그아웃"}),e.jsx("p",{children:"정말 로그아웃 하시겠습니까?"}),e.jsxs("div",{className:"toast-buttons",children:[e.jsx("button",{className:"common-button button-secondary button-medium",onClick:()=>l.dismiss(x.id),children:"취소"}),e.jsx("button",{className:"common-button button-danger button-medium",onClick:async()=>{l.dismiss(x.id),await t(),r("/login"),l.success("성공적으로 로그아웃 되었습니다.",{duration:3e3})},children:"로그아웃"})]})]}),{duration:1/0})},[t,r]);if(!s||!a)return e.jsx("div",{className:"mypage-container",style:{display:"flex",justifyContent:"center",alignItems:"center",height:"80vh"},children:e.jsx(O,{})});const m=a.referredBy===null,h=!a.nicknameChanged&&!a.nickname;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"customer-page-container mypage-container",children:[e.jsx(Z,{userDocument:a,onTierClick:()=>n(!0)}),e.jsxs("div",{className:"mypage-menu-list-wrapper",children:[e.jsx(ee,{referralCode:a?.referralCode}),e.jsx(se,{}),(h||m)&&e.jsxs("div",{className:"mypage-task-section",children:[h&&e.jsx(D,{userDocument:a}),m&&e.jsx(X,{})]})]}),e.jsx("div",{className:"logout-section",children:e.jsxs("button",{onClick:c,className:"logout-button",children:[e.jsx(W,{size:16}),"로그아웃"]})})]}),e.jsx(Y,{isOpen:o,onClose:()=>n(!1)})]})};export{ge as default};
