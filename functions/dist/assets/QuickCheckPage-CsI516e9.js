import{j as s,L,r as x,V as b,ah as U,ai as R,aB as z,S as F}from"./index-BMz7zIRN.js";import{u as Q,r as K,f as G,s as H,a as A}from"./orderService-Bzti28Gn.js";import{f as V}from"./formatUtils-C7pUNVKC.js";import{c as w}from"./createLucideIcon-Df3tO_ja.js";import{U as O,M as W,P as B}from"./user-B2WtjEKL.js";import{S as X}from"./shield-x-DqlWjWof.js";import{S as Y,a as J,G as Z,C as ss}from"./sparkles-CiURa8Z7.js";import{f as es}from"./number-D3CZtsVU.js";import{C as ts}from"./circle-plus-DMyLxw0U.js";import{C as as}from"./circle-check-big-B897TBEZ.js";import{C as ns}from"./circle-x-fkkSg6hU.js";import{T as cs}from"./trash-2-C0X2zetg.js";import{D as is}from"./dollar-sign-DcMg-NJE.js";import{S as os}from"./shield-DCKi_qae.js";import{S as T}from"./save-B2IXE8Sx.js";import{T as rs}from"./triangle-alert-DUarG1oM.js";import{f as ls,k as ds}from"./ko-rCIX9F0R.js";import{m as us,A as ms}from"./proxy-CA4nXXUX.js";import{A as ps}from"./arrow-left-Brk6UMhG.js";import{S as $}from"./search-C7k3Fw0J.js";import{X as hs}from"./x-BfIBbJBP.js";import{U as _}from"./users-L5EP99wQ.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],js=w("chart-column",xs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}]],fs=w("circle-minus",Ns);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["line",{x1:"3",x2:"9",y1:"12",y2:"12",key:"1dyftd"}],["line",{x1:"15",x2:"21",y1:"12",y2:"12",key:"oup4p8"}]],ys=w("git-commit-horizontal",gs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],ks=w("rotate-ccw",bs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=[["path",{d:"m13.5 8.5-5 5",key:"1cs55j"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],vs=w("search-slash",Cs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Ps=w("square-check-big",Ss);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],Ds=w("undo-2",ws),Es=a=>{switch(a){case"ê³µêµ¬ì˜ ì‹ ":return{icon:s.jsx(ss,{size:24}),className:"tier-god"};case"ê³µêµ¬ì™•":return{icon:s.jsx(Z,{size:24}),className:"tier-king"};case"ê³µêµ¬ìš”ì •":return{icon:s.jsx(J,{size:24}),className:"tier-fairy"};case"ê³µêµ¬ìƒˆì‹¹":return{icon:s.jsx("i",{className:"seedling-icon-summary",children:"ğŸŒ±"}),className:"tier-sprout"};case"ì£¼ì˜ ìš”ë§":return{icon:s.jsx(Y,{size:24}),className:"tier-warning"};case"ì°¸ì—¬ ì œí•œ":return{icon:s.jsx(X,{size:24}),className:"tier-restricted"};default:return{icon:s.jsx("i",{className:"seedling-icon-summary",children:"ğŸŒ±"}),className:"tier-sprout"}}},qs=({user:a})=>{const{loyaltyTier:l="ê³µêµ¬ìƒˆì‹¹",pickupCount:d=0,noShowCount:u=0}=a,c=Es(l),m=d+u,p=m>0?d/m*100:0;return s.jsxs("div",{className:`cps-card ${c.className}`,children:[s.jsxs("div",{className:"cps-card-header",children:[s.jsx("div",{className:"cps-tier-icon",children:c.icon}),s.jsxs("div",{className:"cps-tier-info",children:[s.jsx("span",{className:"cps-tier-name",children:l}),s.jsxs("h3",{className:"cps-user-name",children:[a.displayName,a.nickname&&` (${a.nickname})`]})]})]}),s.jsxs("div",{className:"cps-section",children:[s.jsxs("h4",{className:"cps-section-title",children:[s.jsx(js,{size:16}),"ì£¼ìš” í†µê³„"]}),s.jsxs("div",{className:"cps-stats-grid",children:[s.jsxs("div",{className:"cps-grid-item",children:[s.jsx("span",{children:"í”½ì—…"}),s.jsxs("strong",{className:"text-success",children:[d,"ê±´"]})]}),s.jsxs("div",{className:"cps-grid-item",children:[s.jsx("span",{children:"ë…¸ì‡¼"}),s.jsxs("strong",{className:"text-danger",children:[u,"íšŒ"]})]}),s.jsxs("div",{className:"cps-grid-item",children:[s.jsx("span",{children:"í”½ì—…ë¥ "}),s.jsxs("strong",{className:"text-primary",children:[p.toFixed(1),"%"]})]}),s.jsxs("div",{className:"cps-grid-item",children:[s.jsx("span",{children:"ì‹ ë¢°ë„ í¬ì¸íŠ¸"}),s.jsxs("strong",{className:"text-points",children:[(a.points||0).toLocaleString()," P"]})]})]})]}),s.jsxs("div",{className:"cps-section",children:[s.jsxs("h4",{className:"cps-section-title",children:[s.jsx(O,{size:16}),"ì—°ë½ì²˜ ì •ë³´"]}),s.jsxs("div",{className:"cps-info-item",children:[s.jsxs("span",{className:"cps-info-label",children:[s.jsx(W,{size:14}),"ì´ë©”ì¼"]}),s.jsx("span",{className:"cps-info-value",children:a.email||"ì •ë³´ ì—†ìŒ"})]}),s.jsxs("div",{className:"cps-info-item",children:[s.jsxs("span",{className:"cps-info-label",children:[s.jsx(B,{size:14}),"ì—°ë½ì²˜"]}),s.jsx("span",{className:"cps-info-value",children:V(a.phone)})]})]}),s.jsx("div",{className:"cps-card-footer",children:s.jsxs(L,{to:`/admin/users/${a.uid}`,className:"cps-detail-link",children:[s.jsx(O,{size:16}),s.jsx("span",{children:"ìƒì„¸ ì •ë³´ ë° ì „ì²´ ê´€ë¦¬ í˜ì´ì§€ë¡œ ì´ë™"})]})})]})},Ms=({item:a,totalQuantity:l,onUpdateQuantity:d})=>{const[u,c]=x.useState(!1),[m,p]=x.useState(String(l));x.useEffect(()=>{p(String(l))},[l]);const f=()=>{c(!1);const o=parseInt(m,10);if(isNaN(o)||o<=0){b.error("ìœ íš¨í•œ ìˆ˜ëŸ‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."),p(String(l)),d(l);return}o!==l&&d(o)},h=o=>{o.stopPropagation(),c(!0)},j=(o,C)=>{o.stopPropagation();const v=Math.max(1,parseInt(m||"0",10)+C);p(String(v))},N=o=>{o.stopPropagation()},g=o=>{let C=o.productName||"";return o.variantGroupName&&o.variantGroupName!==o.productName&&(C+=` - ${o.variantGroupName}`),o.itemName&&(C+=` (${o.itemName})`),C};return s.jsxs("div",{className:"qco-item",onClick:o=>o.stopPropagation(),children:[s.jsx("span",{className:"qco-item-name",title:g(a),children:g(a)}),u?s.jsxs("div",{className:"qco-qty-editor",onClick:N,children:[s.jsx("button",{type:"button",onClick:o=>j(o,-1),children:s.jsx(fs,{size:18})}),s.jsx("input",{type:"number",className:"qco-qty-input",value:m,onChange:o=>p(o.target.value),onBlur:f,onKeyDown:o=>{o.key==="Enter"&&o.target.blur(),o.key==="Escape"&&(c(!1),p(String(l)))},autoFocus:!0}),s.jsx("button",{type:"button",onClick:o=>j(o,1),children:s.jsx(ts,{size:18})})]}):s.jsxs("span",{className:"qco-item-qty",onClick:h,title:"ìˆ˜ëŸ‰ í´ë¦­í•˜ì—¬ ìˆ˜ì •",children:[l,"ê°œ"]})]})},Is=({group:a,onSelect:l,isSelected:d,onQuantityChange:u})=>{const{groupKey:c,status:m,item:p,totalPrice:f,customerInfo:h,pickupDate:j,pickupDeadlineDate:N,totalQuantity:g}=a,o=k=>{if(!k)return"ë¯¸ì§€ì •";let i;if(typeof k.toDate=="function")i=k.toDate();else if(typeof k.seconds=="number")i=new Date(k.seconds*1e3);else return"í˜•ì‹ ì˜¤ë¥˜";if(isNaN(i.getTime()))return"ë‚ ì§œ ì˜¤ë¥˜";const t=String(i.getMonth()+1).padStart(2,"0"),e=String(i.getDate()).padStart(2,"0"),n=["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "][i.getDay()];return`${t}/${e}(${n})`},C=(k,i)=>{const t=r=>r?typeof r.toDate=="function"?r.toDate():typeof r.seconds=="number"?new Date(r.seconds*1e3):null:null,e=t(k),n=t(i);return!e||!n?!1:e.getFullYear()===n.getFullYear()&&e.getMonth()===n.getMonth()&&e.getDate()===n.getDate()},v=k=>{switch(k){case"PICKED_UP":return"bg-picked-up-strong";case"PREPAID":return"bg-prepaid-strong";case"NO_SHOW":return"bg-noshow-strong";case"CANCELED":return"bg-canceled";default:return"bg-default"}},S=j,D=N??j,E=C(S,D),q=k=>{u(a,k)};return s.jsxs("div",{className:`qc-order-card ${d?"selected":""} ${v(m)}`,onClick:()=>l(c),children:[d&&s.jsx("div",{className:"qco-checkmark",children:s.jsx(Ps,{size:24})}),s.jsx("div",{className:"qco-top-row",children:E?s.jsxs("span",{className:"today",children:["ğŸ”¥ ",o(S)," ë‹¹ì¼í”½ì—…"]}):s.jsxs(s.Fragment,{children:[s.jsxs("span",{children:[o(S)," ì…ê³ "]}),s.jsxs("span",{children:[o(D)," ë§ˆê°"]})]})}),s.jsx("div",{className:"qco-body",children:s.jsx(Ms,{item:p,totalQuantity:g,onUpdateQuantity:q})}),s.jsxs("div",{className:"qco-bottom-row",children:[s.jsx("span",{className:"qco-customer-name",title:`ì „í™”ë²ˆí˜¸: ${h.phone}`,children:h.name}),s.jsxs("span",{className:"qco-total-price",children:[es(f),"ì›"]})]})]})},I=async(a,l,d,u,c)=>{l();const m=b.loading(c.loading);try{await a(),b.success(c.success,{id:m}),u()}catch(p){d(),b.error(p.message||c.error,{id:m})}},zs=({orders:a=[],onStatusChange:l})=>{const d=x.useMemo(()=>[...a].sort((c,m)=>m.createdAt.toMillis()-c.createdAt.toMillis()),[a]),u={RESERVED:{label:"ì˜ˆì•½",className:"status-reserved"},PREPAID:{label:"ì„ ì…ê¸ˆ",className:"status-prepaid"},PICKED_UP:{label:"í”½ì—…ì™„ë£Œ",className:"status-picked-up"},COMPLETED:{label:"ì²˜ë¦¬ì™„ë£Œ",className:"status-picked-up"},CANCELED:{label:"ì·¨ì†Œ",className:"status-canceled"},NO_SHOW:{label:"ë…¸ì‡¼",className:"status-no-show"}};return s.jsx("div",{className:"order-table-container",children:a.length>0?s.jsx("div",{className:"table-responsive",children:s.jsxs("table",{className:"data-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"ì˜ˆì•½ì¼"}),s.jsx("th",{children:"ìƒí’ˆ ì •ë³´"}),s.jsx("th",{children:"ê¸ˆì•¡"}),s.jsx("th",{children:"ìƒíƒœ"})]})}),s.jsx("tbody",{children:d.map(c=>{const m=["PICKED_UP","NO_SHOW","CANCELED"].includes(c.status);return s.jsxs("tr",{className:`status-row-${c.status}`,children:[s.jsx("td",{children:ls(c.createdAt.toDate(),"M/d(eee)",{locale:ds})}),s.jsx("td",{children:c.items.map(p=>`${p.productName} (${p.quantity}ê°œ)`).join(", ")}),s.jsxs("td",{children:[(c.totalPrice||0).toLocaleString(),"ì›"]}),s.jsx("td",{className:"status-cell",children:s.jsx("div",{className:"status-cell-content",children:m?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:`status-badge ${u[c.status]?.className||""}`,children:u[c.status]?.label}),c.status!=="CANCELED"&&s.jsxs("button",{onClick:()=>l(c),className:"revert-button",title:"ì´ì „ ìƒíƒœë¡œ ë˜ëŒë¦¬ê¸°",children:[s.jsx(Ds,{size:14})," ë˜ëŒë¦¬ê¸°"]})]}):s.jsx("span",{className:`status-badge ${u[c.status]?.className||""}`,children:u[c.status]?.label})})})]},c.id)})})]})}):s.jsx("p",{className:"no-data-message",children:"ì£¼ë¬¸ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤."})})},As=({user:a})=>{const[l,d]=x.useState(a.pickupCount||0),[u,c]=x.useState(a.noShowCount||0),[m,p]=x.useState(a.manualTier||"auto");x.useEffect(()=>{d(a.pickupCount||0),c(a.noShowCount||0),p(a.manualTier||"auto")},[a]);const f=()=>{const j=R(a.uid,l,u);b.promise(j,{loading:"ì €ì¥ ì¤‘...",success:"ì €ì¥ ì™„ë£Œ",error:"ì €ì¥ ì‹¤íŒ¨"})},h=()=>{const j=m==="auto"?null:m,N=U(a.uid,j);b.promise(N,{loading:"ì ìš© ì¤‘...",success:"ì ìš© ì™„ë£Œ",error:"ì ìš© ì‹¤íŒ¨"})};return s.jsxs("div",{className:"trust-management-container",children:[s.jsxs("div",{className:"management-section",children:[s.jsxs("h3",{children:[s.jsx(os,{size:20}),"ì‹ ë¢°ë„ ê´€ë¦¬"]}),s.jsx("h4",{children:"ë“±ê¸‰ ì§ì ‘ ì§€ì • (êµ¬ì œìš©)"}),s.jsx("p",{className:"description",children:a.manualTier?s.jsxs(s.Fragment,{children:["í˜„ì¬ ",s.jsx("strong",{style:{color:"var(--accent-color)"},children:a.manualTier})," ë“±ê¸‰ìœ¼ë¡œ ìˆ˜ë™ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤."]}):"í˜„ì¬ í”½ì—…/ë…¸ì‡¼ íšŸìˆ˜ì— ë”°ë¼ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤."}),s.jsxs("div",{className:"role-form",children:[s.jsxs("select",{value:m,onChange:j=>p(j.target.value),children:[s.jsx("option",{value:"auto",children:"ìë™ ê³„ì‚°"}),s.jsx("option",{value:"ê³µêµ¬ì˜ ì‹ ",children:"ê³µêµ¬ì˜ ì‹ "}),s.jsx("option",{value:"ê³µêµ¬ì™•",children:"ê³µêµ¬ì™•"}),s.jsx("option",{value:"ê³µêµ¬ìš”ì •",children:"ê³µêµ¬ìš”ì •"}),s.jsx("option",{value:"ê³µêµ¬ìƒˆì‹¹",children:"ê³µêµ¬ìƒˆì‹¹"}),s.jsx("option",{value:"ì£¼ì˜ ìš”ë§",children:"ì£¼ì˜ ìš”ë§"}),s.jsx("option",{value:"ì°¸ì—¬ ì œí•œ",children:"ì°¸ì—¬ ì œí•œ"})]}),s.jsxs("button",{onClick:h,className:"common-button button-primary button-small",children:[s.jsx(T,{size:14})," ë“±ê¸‰ ì ìš©"]})]})]}),s.jsx("hr",{className:"divider"}),s.jsxs("div",{className:"management-section",children:[s.jsx("h4",{children:"í”½ì—…/ë…¸ì‡¼ íšŸìˆ˜ ì¡°ì • (ë°ì´í„° ë³´ì •ìš©)"}),s.jsxs("div",{className:"counts-form",children:[s.jsxs("div",{className:"form-group-inline",children:[s.jsx("label",{children:"í”½ì—… ì™„ë£Œ"}),s.jsx("input",{type:"number",value:l,onChange:j=>d(Number(j.target.value))})]}),s.jsxs("div",{className:"form-group-inline",children:[s.jsx("label",{children:"ë…¸ì‡¼"}),s.jsx("input",{type:"number",value:u,onChange:j=>c(Number(j.target.value))})]}),s.jsxs("button",{onClick:f,className:"common-button button-secondary button-small",children:[s.jsx(T,{size:14})," íšŸìˆ˜ ì €ì¥"]})]}),s.jsxs("div",{className:"warning-box",children:[s.jsx(rs,{size:16}),s.jsxs("span",{children:[s.jsx("strong",{children:"ì£¼ì˜:"})," ë°ì´í„° ì˜¤ë¥˜ ìˆ˜ì •ì´ í•„ìš”í•œ ëª…í™•í•œ ê²½ìš°ì—ë§Œ ì‚¬ìš©í•˜ì„¸ìš”."]})]})]})]})},Os=({user:a,orders:l=[],onStatUpdate:d,onActionSuccess:u})=>{const[c,m]=x.useState("pickup"),[p,f]=x.useState([]),[h,j]=x.useState(null),N=x.useMemo(()=>{const i=l.filter(e=>e.status==="RESERVED"||e.status==="PREPAID"),t=new Map;return i.forEach(e=>{e.items.forEach(n=>{const r=`${e.userId}-${n.productId}-${n.itemId}-${e.status}`;if(t.has(r)){const y=t.get(r);y.totalQuantity+=n.quantity,y.totalPrice+=n.unitPrice*n.quantity,y.originalOrders.push({orderId:e.id,quantity:n.quantity,status:e.status})}else t.set(r,{groupKey:r,customerInfo:e.customerInfo,item:n,totalQuantity:n.quantity,totalPrice:n.unitPrice*n.quantity,status:e.status,pickupDate:e.pickupDate,pickupDeadlineDate:e.pickupDeadlineDate,originalOrders:[{orderId:e.id,quantity:n.quantity,status:e.status}]})})}),Array.from(t.values())},[l]),g=x.useMemo(()=>N.filter(i=>p.includes(i.groupKey)),[N,p]),o=i=>{if(h){b.error("ìˆ˜ëŸ‰ ë³€ê²½ í›„ì—ëŠ” ë¨¼ì € ë¶„í•  ì²˜ë¦¬ë¥¼ ì™„ë£Œí•´ì£¼ì„¸ìš”.");return}f(t=>t.includes(i)?t.filter(e=>e!==i):[...t,i])},C=(i,t)=>{if(t!==i.totalQuantity){if(i.originalOrders.length>1){b.error("ë¬¶ì¸ ê·¸ë£¹ì˜ ìˆ˜ëŸ‰ì€ ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");return}j({group:i,newQuantity:t}),f([i.groupKey])}else j(null),f([])},v=i=>{if(p.length===0)return;const t=g.flatMap(y=>y.originalOrders.map(P=>P.orderId)),e=g.reduce((y,P)=>y+P.totalPrice,0),n={},r={loading:"ìƒíƒœ ë³€ê²½ ì¤‘...",success:"ìƒíƒœê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.",error:"ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨"};if(i==="PICKED_UP"){const y=Math.floor(e*.005);n.pickup=1,n.points=y,r.success=`í”½ì—… ì™„ë£Œ! ${y}P ì ë¦½.`}if(i==="CANCELED"||i==="NO_SHOW"){const M=-50+-Math.floor(e*.05);n.noshow=1,n.points=M,r.success=`ì²˜ë¦¬ ì™„ë£Œ! ${M}P ì°¨ê°.`}I(()=>Q(t,i),()=>d(n),()=>d({pickup:-(n.pickup||0),noshow:-(n.noshow||0),points:-(n.points||0)}),u,r)},S=i=>{const t=i.status,e=i.totalPrice,n={};if(t==="PICKED_UP"){const r=-Math.floor(e*.005);n.pickup=-1,n.points=r}if(t==="CANCELED"||t==="NO_SHOW"){const P=50+Math.floor(e*.05);n.noshow=-1,n.points=P}I(()=>K([i.id],t),()=>d(n),()=>d({pickup:-(n.pickup||0),noshow:-(n.noshow||0),points:-(n.points||0)}),u,{loading:"ìƒíƒœë¥¼ ë˜ëŒë¦¬ëŠ” ì¤‘...",success:"ì˜ˆì•½ ìƒíƒœë¡œ ë˜ëŒë ¸ìŠµë‹ˆë‹¤.",error:"ë˜ëŒë¦¬ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."})},D=()=>{if(p.length===0)return;const i=g.flatMap(t=>t.originalOrders.map(e=>e.orderId));I(()=>G(i),()=>{},()=>{},u,{loading:"ì£¼ë¬¸ ì‚­ì œ ì¤‘...",success:"ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.",error:"ì‚­ì œ ì‹¤íŒ¨"})},E=()=>{if(!h)return;const i=t=>{const e=h.group.originalOrders[0].orderId,r={pickup:1,points:Math.floor(h.group.item.unitPrice*h.newQuantity*.005)};if(t==="NO_SHOW"){const y=-50-Math.floor((h.group.totalPrice-h.group.item.unitPrice*h.newQuantity)*.05);r.noshow=1,r.points=(r.points||0)+y}I(()=>H(e,h.newQuantity,t),()=>d(r),()=>d({pickup:-(r.pickup||0),noshow:-(r.noshow||0),points:-(r.points||0)}),u,{loading:"ë¶„í•  ì²˜ë¦¬ ì¤‘...",success:"ë¶„í•  ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.",error:"ë¶„í•  ì²˜ë¦¬ ì‹¤íŒ¨"})};b.custom(t=>s.jsxs("div",{className:"confirmation-toast",children:[s.jsx("h4",{children:"ë¶„í•  ì²˜ë¦¬ í™•ì¸"}),s.jsxs("p",{children:[s.jsxs("strong",{children:[h.newQuantity,"ê°œ"]}),"ë¥¼ í”½ì—… ì²˜ë¦¬í•˜ê³ ,",s.jsx("br",{}),"ë‚¨ì€ ",s.jsxs("strong",{children:[h.group.totalQuantity-h.newQuantity,"ê°œ"]}),"ëŠ” ì–´ë–»ê²Œ í• ê¹Œìš”?"]}),s.jsxs("div",{className:"toast-buttons",children:[s.jsx("button",{className:"common-button button-danger button-medium",onClick:()=>{b.dismiss(t.id),i("NO_SHOW")},children:"ë…¸ì‡¼ ì²˜ë¦¬"}),s.jsx("button",{className:"common-button button-secondary button-medium",onClick:()=>{b.dismiss(t.id),i("RESERVED")},children:"ì˜ˆì•½ ìœ ì§€"}),s.jsx("button",{className:"common-button button-light button-medium",onClick:()=>b.dismiss(t.id),children:"ì·¨ì†Œ"})]})]}),{duration:1/0,position:"top-center"})},q=()=>{switch(c){case"pickup":return s.jsxs("div",{className:"qcp-results-grid",children:[N.map(i=>s.jsx(Is,{group:i,isSelected:p.includes(i.groupKey),onSelect:o,onQuantityChange:C},i.groupKey)),N.length===0&&s.jsx("p",{className:"no-data-message",children:"ì²˜ë¦¬ ëŒ€ê¸°ì¤‘ì¸ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤."})]});case"history":return s.jsx(zs,{orders:l,onStatusChange:S});case"manage":return s.jsx(As,{user:a});default:return null}},k=()=>{if(c!=="pickup"||p.length===0)return null;const i=g.reduce((n,r)=>n+r.totalPrice,0);if(h)return s.jsxs("div",{className:"cat-action-footer",children:[s.jsxs("span",{className:"cat-footer-summary",children:[h.group.item.productName,": ",h.group.totalQuantity,"ê°œ ì¤‘ ",h.newQuantity,"ê°œ"]}),s.jsx("div",{className:"cat-footer-actions",children:s.jsxs("button",{onClick:E,className:"common-button button-pickup",children:[s.jsx(ys,{size:16})," ë¶„í•  í”½ì—…"]})})]});const e=g.length>0&&g.every(n=>n.status==="PREPAID")?s.jsxs("button",{onClick:()=>v("RESERVED"),className:"common-button button-prepaid-cancel",children:[s.jsx(ks,{size:16})," ì„ ì…ê¸ˆ ì·¨ì†Œ"]}):s.jsxs("button",{onClick:()=>v("PREPAID"),className:"common-button button-prepaid",children:[s.jsx(is,{size:16})," ì„ ì…ê¸ˆ"]});return s.jsxs("div",{className:"cat-action-footer",children:[s.jsxs("span",{className:"cat-footer-summary",children:[p.length,"ê±´ ì„ íƒ / ",i.toLocaleString(),"ì›"]}),s.jsxs("div",{className:"cat-footer-actions",children:[s.jsxs("button",{onClick:()=>v("PICKED_UP"),className:"common-button button-pickup",children:[s.jsx(as,{size:20})," í”½ì—…"]}),e,s.jsxs("button",{onClick:()=>v("CANCELED"),className:"common-button button-cancel",children:[s.jsx(ns,{size:16})," ì·¨ì†Œ"]}),s.jsxs("button",{onClick:D,className:"common-button button-dark",children:[s.jsx(cs,{size:16})," ì‚­ì œ"]})]})]})};return s.jsxs("div",{className:"cat-container",children:[s.jsxs("div",{className:"cat-tab-navigation",children:[s.jsxs("button",{className:c==="pickup"?"active":"",onClick:()=>m("pickup"),children:["í”½ì—… ì¹´ë“œ (",N.length,")"]}),s.jsxs("button",{className:c==="history"?"active":"",onClick:()=>m("history"),children:["ì „ì²´ ì£¼ë¬¸ ë‚´ì—­ (",l.length,")"]}),s.jsx("button",{className:c==="manage"?"active":"",onClick:()=>m("manage"),children:"ì‹ ë¢°ë„ ê´€ë¦¬"})]}),s.jsx("div",{className:`cat-tab-content ${c==="pickup"?"is-grid-view":""}`,children:q()}),k()]})},Ts=({user:a,orders:l,onBack:d,onStatUpdate:u,onActionSuccess:c})=>s.jsxs(us.div,{className:"cfv-container",initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.98},transition:{duration:.3},children:[s.jsx("div",{className:"cfv-header",children:s.jsxs("button",{onClick:d,className:"cfv-back-button",children:[s.jsx(ps,{size:20}),s.jsx("span",{children:"ì „ì²´ ê²€ìƒ‰ìœ¼ë¡œ ëŒì•„ê°€ê¸°"})]})}),s.jsxs("div",{className:"cfv-body",children:[s.jsx("aside",{className:"cfv-left-column",children:s.jsx(qs,{user:a})}),s.jsx("main",{className:"cfv-right-column",children:s.jsx(Os,{user:a,orders:l,onStatUpdate:u,onActionSuccess:c})})]})]}),$s=({user:a,onSelect:l})=>s.jsxs("button",{className:"user-search-result-item",onClick:()=>l(a),children:[s.jsxs("div",{className:"user-info",children:[s.jsx("span",{className:"user-name",children:a.displayName}),s.jsx("span",{className:"user-phone",children:a.phone||"ì „í™”ë²ˆí˜¸ ë¯¸ë“±ë¡"})]}),s.jsx("div",{className:"user-tier",children:s.jsx("span",{children:a.loyaltyTier})})]}),ie=()=>{const[a,l]=x.useState(""),[d,u]=x.useState(!0),[c,m]=x.useState(null),[p,f]=x.useState([]),[h,j]=x.useState(!1),[N,g]=x.useState([]),[o,C]=x.useState([]);x.useEffect(()=>{(async()=>{try{const e=await z();C(e)}catch{b.error("ì „ì²´ ì‚¬ìš©ì ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{u(!1)}})()},[]);const v=t=>{t?.preventDefault();const e=a.trim();if(e.length<2){b.error("ê²€ìƒ‰ì–´ëŠ” 2ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.");return}u(!0),j(!0),m(null),g([]),f([]);const n=o.filter(r=>{const y=e.toLowerCase(),P=r.displayName?.toLowerCase().includes(y),M=r.phoneLast4&&r.phoneLast4.endsWith(e);return P||M});n.length===0||(n.length===1?S(n[0]):g(n)),setTimeout(()=>u(!1),200)},S=x.useCallback(async t=>{u(!0),g([]),m(t);try{const e=await A(t.uid);f(e)}catch{b.error("ì‚¬ìš©ìì˜ ì£¼ë¬¸ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤."),f([])}finally{u(!1)}},[]),D=x.useCallback(t=>{m(e=>e?{...e,pickupCount:Math.max(0,(e.pickupCount||0)+(t.pickup||0)),noShowCount:Math.max(0,(e.noShowCount||0)+(t.noshow||0)),points:(e.points||0)+(t.points||0)}:null)},[]),E=x.useCallback(async()=>{if(c){u(!0);try{const t=await A(c.uid);f(t);const e=await z();C(e);const n=e.find(r=>r.uid===c.uid);n&&m(n)}catch{b.error("ë°ì´í„°ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.")}finally{u(!1)}}},[c]),q=()=>{m(null),f([])},k=()=>{l(""),j(!1),g([]),m(null),f([])};x.useEffect(()=>{N.length>0&&m(null)},[N]);const i=h&&!d&&!c&&N.length===0;return s.jsxs("div",{className:"quick-check-page",children:[s.jsx("header",{className:"qcp-header",children:s.jsx("h1",{children:"ë¹ ë¥¸ ì˜ˆì•½ í™•ì¸"})}),s.jsx("div",{className:"qcp-search-container",children:s.jsxs("form",{onSubmit:v,className:"qcp-search-form",children:[s.jsxs("div",{className:"qcp-input-wrapper",children:[s.jsx($,{className:"qcp-input-icon",size:18}),s.jsx("input",{type:"text",value:a,onChange:t=>l(t.target.value),placeholder:"ê³ ê° ì´ë¦„ ë˜ëŠ” ì „í™”ë²ˆí˜¸ ë’· 4ìë¦¬",className:"qcp-input"}),a&&s.jsx(hs,{className:"qcp-clear-icon",size:18,onClick:k})]}),s.jsxs("button",{type:"submit",className:"qcp-search-button",disabled:d,children:[s.jsx($,{size:16}),s.jsx("span",{children:"ê²€ìƒ‰"})]})]})}),s.jsxs(ms,{mode:"wait",children:[d&&s.jsx(F,{message:"ì‚¬ìš©ì ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘..."}),!d&&c&&s.jsx(Ts,{user:c,orders:p,onBack:q,onStatUpdate:D,onActionSuccess:E}),!d&&!c&&s.jsx("div",{className:"qcp-results-container",children:N.length>0?s.jsxs("div",{className:"disambiguation-box",children:[s.jsxs("h3",{children:[s.jsx(_,{size:16}),"ì—¬ëŸ¬ë¶„ì´ ê²€ìƒ‰ë˜ì—ˆìŠµë‹ˆë‹¤. ì„ íƒí•´ì£¼ì„¸ìš”."]}),N.map(t=>s.jsx($s,{user:t,onSelect:S},t.uid))]}):i?s.jsxs("div",{className:"qcp-initial-prompt",children:[s.jsx(vs,{size:48,className:"prompt-icon"}),s.jsxs("p",{children:["'",a,"'ì— ëŒ€í•œ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.",s.jsx("br",{}),"ì´ë¦„ ë˜ëŠ” ì „í™”ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”."]})]}):!h&&s.jsxs("div",{className:"qcp-initial-prompt",children:[s.jsx(_,{size:48,className:"prompt-icon"}),s.jsxs("p",{children:["ê³ ê°ì˜ ì´ë¦„ ë˜ëŠ” ì „í™”ë²ˆí˜¸ ë’· 4ìë¦¬ë¥¼ ê²€ìƒ‰í•˜ì—¬",s.jsx("br",{}),"ì˜ˆì•½ ë‚´ì—­ì„ ë¹ ë¥´ê²Œ í™•ì¸í•˜ê³  ì²˜ë¦¬í•˜ì„¸ìš”."]})]})})]})]})};export{ie as default};
