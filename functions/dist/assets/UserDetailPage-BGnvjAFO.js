import{o as q,u as T,b as W,r as i,B as f,af as K,j as s,S as V,V as m,Q as G,G as B,C as b,D as w,ag as X,ah as Q,ai as Z,aj as J}from"./index-BMz7zIRN.js";import{a as Y}from"./orderService-Bzti28Gn.js";import{u as ss}from"./useDocumentTitle-BBAuQihd.js";import{P as es,D as as}from"./PointManagementModal-DQ5B4Jdr.js";import{f as ts}from"./formatUtils-C7pUNVKC.js";import{A as ns}from"./arrow-left-Brk6UMhG.js";import{U as D,M as is,P as ls}from"./user-B2WtjEKL.js";import{L as cs}from"./list-ordered-a_4-UPcK.js";import{H as os}from"./hourglass-Cbw8WS9u.js";import{c as j}from"./createLucideIcon-Df3tO_ja.js";import{S as P}from"./shield-check-80tGVhw7.js";import{S as rs}from"./shield-x-DqlWjWof.js";import{S as L,a as ds,G as ms,C as hs}from"./sparkles-CiURa8Z7.js";import{S as $}from"./save-B2IXE8Sx.js";import{X as us}from"./x-BfIBbJBP.js";import{S as xs}from"./square-pen-CwtIThVX.js";import{C as js}from"./chart-no-axes-column-CffmgICP.js";import{S as ps}from"./shield-DCKi_qae.js";import{T as A}from"./triangle-alert-DUarG1oM.js";import{T as M}from"./trash-2-C0X2zetg.js";import"./loader-circle-B7eOStzy.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],vs=j("activity",Ns);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]],bs=j("ban",fs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 8v8",key:"napkw2"}],["path",{d:"m8 12 4 4 4-4",key:"k98ssh"}]],ys=j("circle-arrow-down",gs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]],Ss=j("circle-arrow-up",ks);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=[["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m14.305 16.53.923-.382",key:"1itpsq"}],["path",{d:"m15.228 13.852-.923-.383",key:"eplpkm"}],["path",{d:"m16.852 12.228-.383-.923",key:"13v3q0"}],["path",{d:"m16.852 17.772-.383.924",key:"1i8mnm"}],["path",{d:"m19.148 12.228.383-.923",key:"1q8j1v"}],["path",{d:"m19.53 18.696-.382-.924",key:"vk1qj3"}],["path",{d:"m20.772 13.852.924-.383",key:"n880s0"}],["path",{d:"m20.772 16.148.924.383",key:"1g6xey"}],["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],zs=j("user-cog",Cs),Ts={"공구의 신":{icon:s.jsx(hs,{size:20}),color:"var(--loyalty-god)"},공구왕:{icon:s.jsx(ms,{size:20}),color:"var(--loyalty-king)"},공구요정:{icon:s.jsx(ds,{size:20}),color:"var(--loyalty-fairy)"},공구새싹:{icon:s.jsx("i",{className:"seedling-icon-large",children:"🌱"}),color:"var(--loyalty-sprout)"},"주의 요망":{icon:s.jsx(L,{size:20}),color:"var(--loyalty-warning)"},"참여 제한":{icon:s.jsx(rs,{size:20}),color:"var(--loyalty-restricted)"}},z={RESERVED:{label:"예약",className:"status-reserved"},PREPAID:{label:"선입금",className:"status-prepaid"},PICKED_UP:{label:"픽업완료",className:"status-picked-up"},COMPLETED:{label:"처리완료",className:"status-picked-up"},CANCELED:{label:"취소",className:"status-canceled"},NO_SHOW:{label:"노쇼",className:"status-no-show"}},le=()=>{const{userId:e}=q(),t=T(),{userDocument:a}=W(),[n,l]=i.useState(null),[o,r]=i.useState(!0),[c,h]=i.useState("profile"),[d,u]=i.useState([]),[N,g]=i.useState(!1),[y,U]=i.useState([]),[E,k]=i.useState(!1),[I,R]=i.useState([]),[O,S]=i.useState(!1),[C,_]=i.useState(new Set(["profile"]));ss(n?`${n.displayName||"고객"}님의 정보`:"고객 정보"),i.useEffect(()=>{if(!e){t("/admin/users");return}r(!0);const p=f(b,"users",e),x=K(p,v=>{v.exists()?l({uid:v.id,...v.data()}):(m.error("사용자 정보를 찾을 수 없습니다."),t("/admin/users")),r(!1)});return()=>x()},[e,t]),i.useEffect(()=>{if(!e||C.has(c))return;(async()=>{switch(_(x=>new Set(x).add(c)),c){case"orders":g(!0),Y(e).then(u).finally(()=>g(!1));break;case"waitlist":k(!0),B(e).then(U).finally(()=>k(!1));break;case"points":S(!0),G(e).then(R).finally(()=>S(!1));break}})()},[c,e,C]);const F=i.useMemo(()=>[...d].sort((p,x)=>x.createdAt.toMillis()-p.createdAt.toMillis()),[d]);if(o||!n)return s.jsx(V,{message:"고객 상세 정보를 불러오는 중..."});const H=()=>{switch(c){case"orders":return N?s.jsx("div",{className:"tab-loader",children:"주문 내역을 불러오는 중..."}):s.jsx(Es,{title:"주문 전체 내역",orders:F});case"waitlist":return E?s.jsx("div",{className:"tab-loader",children:"대기 목록을 불러오는 중..."}):s.jsx(Is,{title:"대기 목록",items:y});case"points":return O?s.jsx("div",{className:"tab-loader",children:"포인트 활동을 불러오는 중..."}):s.jsx(Rs,{title:"포인트 활동",history:I});case"profile":default:return s.jsx(Ds,{user:n,currentAdmin:a})}};return s.jsxs("div",{className:"user-detail-page-container",children:[s.jsxs("button",{onClick:()=>t(-1),className:"back-button",children:[s.jsx(ns,{size:20}),s.jsx("span",{children:"고객 목록으로 돌아가기"})]}),s.jsx(ws,{user:n}),s.jsxs("div",{className:"tab-navigation",children:[s.jsxs("button",{className:`tab-button ${c==="profile"?"active":""}`,onClick:()=>h("profile"),children:[s.jsx(D,{size:16}),"프로필"]}),s.jsxs("button",{className:`tab-button ${c==="orders"?"active":""}`,onClick:()=>h("orders"),children:[s.jsx(cs,{size:16}),"주문 내역 (",d.length,")"]}),s.jsxs("button",{className:`tab-button ${c==="waitlist"?"active":""}`,onClick:()=>h("waitlist"),children:[s.jsx(os,{size:16}),"대기 목록 (",y.length,")"]}),s.jsxs("button",{className:`tab-button ${c==="points"?"active":""}`,onClick:()=>h("points"),children:[s.jsx(vs,{size:16}),"포인트 활동"]})]}),s.jsx("div",{className:"tab-content",children:H()})]})},ws=({user:e})=>{const[t,a]=i.useState(!1),n=e.loyaltyTier||"공구새싹",l=Ts[n],o=async()=>{const r=!e.isSuspended,c=r?"제한":"제한 해제",h=w(f(b,"users",e.uid),{isSuspended:r});m.promise(h,{loading:`계정을 ${c} 처리하는 중...`,success:`계정이 성공적으로 ${c} 처리되었습니다.`,error:`계정 ${c} 처리에 실패했습니다.`})};return s.jsxs(s.Fragment,{children:[s.jsx(es,{isOpen:t,onClose:()=>a(!1),user:e}),s.jsxs("header",{className:"user-detail-header",children:[s.jsxs("div",{className:"user-info",children:[s.jsx("div",{className:"user-tier-badge",style:{color:l.color,backgroundColor:`${l.color}20`},children:l.icon}),s.jsxs("div",{children:[s.jsxs("h1",{className:"user-name",children:[e.displayName," ",e.nickname&&`(${e.nickname})`]}),s.jsx("div",{className:"user-tier-name",style:{color:l.color},children:n})]})]}),s.jsxs("div",{className:"user-stats-summary",children:[s.jsxs("div",{className:"stat-item",children:[s.jsx("span",{className:"stat-label",children:"신뢰도 포인트"}),s.jsxs("span",{className:"stat-value",children:[(e.points||0).toLocaleString()," P"]})]}),s.jsxs("div",{className:"stat-item",children:[s.jsx("span",{className:"stat-label",children:"총 주문"}),s.jsxs("span",{className:"stat-value",children:[e.totalOrders||0," 건"]})]})]}),s.jsxs("div",{className:"user-actions",children:[s.jsxs("button",{onClick:()=>a(!0),className:"common-button button-primary-outline button-small",children:[s.jsx(as,{size:16}),"포인트 관리"]}),s.jsx("button",{onClick:o,className:`common-button button-small ${e.isSuspended?"button-success-outline":"button-danger-outline"}`,children:e.isSuspended?s.jsxs(s.Fragment,{children:[s.jsx(P,{size:16}),"제한 해제"]}):s.jsxs(s.Fragment,{children:[s.jsx(bs,{size:16}),"이용 제한"]})})]})]})]})},Ds=({user:e,currentAdmin:t})=>s.jsxs("div",{className:"profile-grid-container",children:[s.jsxs("div",{className:"profile-left-column",children:[s.jsx(Ls,{user:e}),t?.role==="master"&&s.jsx(As,{user:e})]}),s.jsxs("div",{className:"profile-right-column",children:[s.jsx($s,{user:e}),s.jsx(Ps,{user:e}),s.jsx(Ms,{user:e})]})]}),Ps=({user:e})=>{const[t,a]=i.useState(e.pickupCount||0),[n,l]=i.useState(e.noShowCount||0),[o,r]=i.useState(e.manualTier||"auto");i.useEffect(()=>{a(e.pickupCount||0),l(e.noShowCount||0),r(e.manualTier||"auto")},[e]);const c=()=>{const d=Z(e.uid,t,n);m.promise(d,{loading:"횟수 및 등급 재계산 중...",success:"성공적으로 반영되었습니다.",error:u=>u.message||"작업 실패"})},h=()=>{const d=o==="auto"?null:o,u=Q(e.uid,d);m.promise(u,{loading:"등급을 수동으로 적용하는 중...",success:"등급이 성공적으로 변경되었습니다.",error:N=>N.message||"작업 실패"})};return s.jsxs("div",{className:"info-card",children:[s.jsxs("h3",{children:[s.jsx(ps,{size:20}),"신뢰도 관리"]}),s.jsxs("div",{className:"management-section",children:[s.jsx("h4",{children:"등급 직접 지정 (구제용)"}),s.jsx("p",{className:"description",children:e.manualTier?s.jsxs(s.Fragment,{children:["현재 ",s.jsx("strong",{style:{color:"var(--accent-color)"},children:e.manualTier})," 등급으로 수동 설정되어 있습니다."]}):"현재 픽업/노쇼 횟수에 따라 자동 계산됩니다."}),s.jsxs("div",{className:"role-form",children:[s.jsxs("select",{value:o,onChange:d=>r(d.target.value),children:[s.jsx("option",{value:"auto",children:"자동 계산"}),s.jsx("option",{value:"공구의 신",children:"공구의 신"}),s.jsx("option",{value:"공구왕",children:"공구왕"}),s.jsx("option",{value:"공구요정",children:"공구요정"}),s.jsx("option",{value:"공구새싹",children:"공구새싹"}),s.jsx("option",{value:"주의 요망",children:"주의 요망"}),s.jsx("option",{value:"참여 제한",children:"참여 제한"})]}),s.jsxs("button",{onClick:h,className:"common-button button-primary button-small",children:[s.jsx(P,{size:14})," 등급 적용"]})]})]}),s.jsx("hr",{className:"divider"}),s.jsxs("div",{className:"management-section",children:[s.jsx("h4",{children:"픽업/노쇼 횟수 조정 (데이터 보정용)"}),s.jsxs("div",{className:"counts-form",children:[s.jsxs("div",{className:"form-group-inline",children:[s.jsx("label",{children:"픽업 완료"}),s.jsx("input",{type:"number",value:t,onChange:d=>a(Number(d.target.value))})]}),s.jsxs("div",{className:"form-group-inline",children:[s.jsx("label",{children:"노쇼"}),s.jsx("input",{type:"number",value:n,onChange:d=>l(Number(d.target.value))})]}),s.jsxs("button",{onClick:c,className:"common-button button-secondary button-small",children:[s.jsx($,{size:14})," 횟수 저장"]})]}),s.jsxs("div",{className:"warning-box",children:[s.jsx(A,{size:16}),s.jsxs("span",{children:[s.jsx("strong",{children:"주의:"})," 이 값을 직접 수정하면 사용자의 등급 기록에 영구적인 영향을 미칩니다. 데이터 오류 수정이 필요한 명확한 경우에만 사용하세요."]})]})]})]})},Ls=({user:e})=>{const[t,a]=i.useState(!1),[n,l]=i.useState(e.nickname||"");i.useEffect(()=>{l(e.nickname||"")},[e]);const o=async()=>{if(n.trim().length>7){m.error("닉네임은 7자 이하로 입력해주세요.");return}const r=f(b,"users",e.uid),c=w(r,{nickname:n.trim()});m.promise(c,{loading:"닉네임 저장 중...",success:"닉네임이 저장되었습니다.",error:"닉네임 저장에 실패했습니다."}),await c,a(!1)};return s.jsxs("div",{className:"info-card",children:[s.jsxs("h3",{children:[s.jsx(D,{size:20}),"기본 정보"]}),s.jsxs("div",{className:"info-item",children:[s.jsx("span",{className:"info-label",children:"이름"}),s.jsx("span",{className:"info-value",children:e.displayName})]}),s.jsxs("div",{className:"info-item",children:[s.jsx("span",{className:"info-label",children:"닉네임"}),t?s.jsxs("div",{className:"nickname-edit-form",children:[s.jsx("input",{type:"text",value:n,onChange:r=>l(r.target.value),maxLength:7,placeholder:"7자 이내",autoFocus:!0}),s.jsx("button",{onClick:o,className:"action-btn-icon",title:"저장",children:s.jsx($,{size:16})}),s.jsx("button",{onClick:()=>a(!1),className:"action-btn-icon",title:"취소",children:s.jsx(us,{size:16})})]}):s.jsxs("div",{className:"info-value-group",children:[s.jsx("span",{className:"info-value",children:e.nickname||"없음"}),s.jsx("button",{onClick:()=>a(!0),className:"edit-nickname-btn",title:"닉네임 수정",children:s.jsx(xs,{size:14})})]})]}),s.jsxs("div",{className:"info-item",children:[s.jsxs("span",{className:"info-label",children:[s.jsx(is,{size:14})," 이메일"]}),s.jsx("span",{className:"info-value",children:e.email||"정보 없음"})]}),s.jsxs("div",{className:"info-item",children:[s.jsxs("span",{className:"info-label",children:[s.jsx(ls,{size:14})," 연락처"]}),s.jsx("span",{className:"info-value",children:ts(e.phone)})]})]})},$s=({user:e})=>s.jsxs("div",{className:"info-card",children:[s.jsxs("h3",{children:[s.jsx(js,{size:20}),"주요 통계"]}),s.jsxs("div",{className:"stats-grid",children:[s.jsxs("div",{className:"stat-item",children:[s.jsx("h4",{children:"신뢰도 포인트"}),s.jsxs("p",{children:[(e.points||0).toLocaleString()," P"]})]}),s.jsxs("div",{className:"stat-item",children:[s.jsx("h4",{children:"총 주문"}),s.jsxs("p",{children:[e.totalOrders||0," 건"]})]}),s.jsxs("div",{className:"stat-item",children:[s.jsx("h4",{children:"픽업율"}),s.jsxs("p",{children:[e.pickupRate?.toFixed(1)??"N/A"," %"]})]}),s.jsxs("div",{className:"stat-item",children:[s.jsx("h4",{children:"노쇼"}),s.jsxs("p",{children:[e.noShowCount||0," 회"]})]})]})]}),As=({user:e})=>{const[t,a]=i.useState(e.role||"customer");i.useEffect(()=>{a(e.role||"customer")},[e]);const n=async()=>{const l=X(e.uid,t);m.promise(l,{loading:"역할을 업데이트하는 중...",success:"역할이 변경되었습니다.",error:"역할 변경에 실패했습니다."})};return s.jsxs("div",{className:"info-card",children:[s.jsxs("h3",{children:[s.jsx(zs,{size:20})," 사용자 권한"]}),s.jsxs("div",{className:"role-form",children:[s.jsxs("select",{value:t,onChange:l=>a(l.target.value),children:[s.jsx("option",{value:"customer",children:"customer"}),s.jsx("option",{value:"admin",children:"admin"}),s.jsx("option",{value:"master",children:"master"})]}),s.jsx("button",{onClick:n,className:"common-button button-primary button-small",children:"권한 저장"})]})]})},Ms=({user:e})=>{const t=T(),a=()=>{const n=e.displayName||"해당 사용자",l=()=>{const o=J(e.uid).then(()=>(t("/admin/users"),"사용자 문서가 성공적으로 삭제되었습니다."));m.promise(o,{loading:`${n} 님을 삭제하는 중...`,success:r=>r,error:r=>`회원 삭제에 실패했습니다: ${r.message}`})};m.custom(o=>s.jsx(Us,{t:o,user:e,onConfirm:()=>{m.dismiss(o.id),l()}}),{duration:1/0,position:"top-center"})};return s.jsxs("div",{className:"info-card danger-zone-card",children:[s.jsxs("h3",{children:[s.jsx(L,{size:20})," 위험 구역"]}),s.jsxs("div",{className:"danger-zone-content",children:[s.jsxs("div",{className:"danger-zone-text",children:[s.jsx("h4",{children:"회원 영구 삭제"}),s.jsx("p",{children:"이 작업은 되돌릴 수 없습니다. 신중하게 결정해주세요."})]}),s.jsxs("button",{onClick:a,className:"common-button button-danger-outline",children:[s.jsx(M,{size:16})," 회원 삭제"]})]})]})},Us=({t:e,user:t,onConfirm:a})=>{const[n,l]=i.useState(""),o="회원 삭제",r=n===o;return s.jsxs("div",{className:"delete-confirm-toast",children:[s.jsxs("div",{className:"toast-header",children:[" ",s.jsx(A,{className:"toast-icon",size:24})," ",s.jsx("h3",{className:"toast-title",children:"회원 영구 삭제"})," "]}),s.jsxs("div",{className:"toast-body",children:[s.jsxs("p",{children:[s.jsx("b",{children:t.displayName})," (",t.email,") 님을 정말 삭제하시겠습니까?",s.jsx("br",{}),"이 작업은 되돌릴 수 없으며, 모든 데이터가 영구적으로 삭제됩니다."]}),s.jsxs("label",{htmlFor:"delete-confirm-input",className:"toast-instruction",children:["삭제를 계속하려면 아래에 ",s.jsx("strong",{className:"confirm-phrase",children:o})," 라고 입력하세요."]}),s.jsx("input",{id:"delete-confirm-input",type:"text",value:n,onChange:c=>l(c.target.value),className:"delete-confirm-input",placeholder:o,autoFocus:!0})]}),s.jsxs("div",{className:"toast-footer",children:[s.jsx("button",{className:"toast-button toast-button-cancel",onClick:()=>m.dismiss(e.id),children:"취소"}),s.jsxs("button",{className:"toast-button toast-button-confirm",onClick:a,disabled:!r,children:[s.jsx(M,{size:16})," 삭제 확인"]})]})]})},Es=({title:e,orders:t})=>s.jsxs("div",{className:"info-card",children:[s.jsxs("h3",{children:[e," (",t.length,")"]}),t.length>0?s.jsx("div",{className:"table-responsive",children:s.jsxs("table",{className:"data-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"예약일"})," ",s.jsx("th",{children:"상품 정보"})," ",s.jsx("th",{children:"수량"})," ",s.jsx("th",{children:"금액"})," ",s.jsx("th",{children:"픽업일"})," ",s.jsx("th",{children:"상태"})]})}),s.jsx("tbody",{children:t.map(a=>s.jsxs("tr",{children:[s.jsx("td",{children:a.createdAt?.toDate().toLocaleDateString("ko-KR")}),s.jsx("td",{children:a.items.map(n=>n.productName).join(", ")}),s.jsx("td",{children:a.items.reduce((n,l)=>n+l.quantity,0)}),s.jsxs("td",{children:[(a.totalPrice||0).toLocaleString(),"원"]}),s.jsx("td",{children:a.pickupDate?.toDate().toLocaleDateString("ko-KR")}),s.jsx("td",{children:s.jsx("span",{className:`status-badge-inline ${z[a.status]?.className||""}`,children:z[a.status]?.label||a.status})})]},a.id))})]})}):s.jsxs("p",{className:"no-data-message",children:[e,"이 없습니다."]})]}),Is=({title:e,items:t})=>s.jsxs("div",{className:"info-card",children:[s.jsxs("h3",{children:[e," (",t.length,")"]}),t.length>0?s.jsx("div",{className:"table-responsive",children:s.jsxs("table",{className:"data-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"신청일"})," ",s.jsx("th",{children:"상품명"})," ",s.jsx("th",{children:"옵션"})," ",s.jsx("th",{children:"수량"})]})}),s.jsx("tbody",{children:t.map(a=>s.jsxs("tr",{children:[s.jsx("td",{children:a.timestamp.toDate().toLocaleDateString("ko-KR")}),s.jsx("td",{children:a.productName}),s.jsx("td",{children:a.itemName}),s.jsx("td",{children:a.quantity})]},`${a.productId}-${a.roundId}-${a.itemId}`))})]})}):s.jsxs("p",{className:"no-data-message",children:[e,"이 없습니다."]})]}),Rs=({title:e,history:t})=>s.jsxs("div",{className:"info-card",children:[s.jsx("h3",{children:e}),t.length>0?s.jsx("ul",{className:"point-timeline",children:t.map((a,n)=>s.jsxs("li",{className:"timeline-item",children:[s.jsx("div",{className:`timeline-icon ${a.amount>0?"positive":"negative"}`,children:a.amount>0?s.jsx(Ss,{size:20}):s.jsx(ys,{size:20})}),s.jsxs("div",{className:"timeline-content",children:[s.jsx("p",{className:"timeline-reason",children:a.reason}),s.jsx("span",{className:"timeline-date",children:a.createdAt?.toDate().toLocaleString("ko-KR")})]}),s.jsxs("span",{className:`timeline-amount ${a.amount>0?"positive":"negative"}`,children:[a.amount>0?"+":"",a.amount.toLocaleString()," P"]})]},`${a.createdAt?.seconds}-${n}`))}):s.jsxs("p",{className:"no-data-message",children:[e," 내역이 없습니다."]})]});export{le as default};
