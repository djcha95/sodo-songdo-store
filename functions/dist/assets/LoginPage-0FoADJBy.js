import{r as u,b as x,u as y,V as r,j as s,s as j,e as E,p as L}from"./index-BMz7zIRN.js";const N=()=>new Promise((n,e)=>{if(window.Kakao&&window.Kakao.isInitialized())return n();const o=()=>{if(window.Kakao)try{const a="d3d9ad6394a41f92ce4bb276a0448a6f";a&&!window.Kakao.isInitialized()&&window.Kakao.init(a),n()}catch(a){console.error("Kakao SDK init error:",a),e(a)}else setTimeout(o,100)};o()}),S=()=>"/api/kakaoLogin",P=()=>{const[n,e]=u.useState(!0),{user:o,loading:a}=x(),d=y();u.useEffect(()=>{N().catch(()=>{r.error("카카오 로그인 기능을 불러오는 데 실패했습니다.")}).finally(()=>{e(!1)})},[]),u.useEffect(()=>{!a&&o&&d("/",{replace:!0})},[o,a,d]);const m=()=>{if(!window.Kakao?.isInitialized()){r.error("카카오 SDK가 아직 준비되지 않았습니다.");return}const g=window.Kakao.Auth?.login;if(typeof g!="function"){r.error("Kakao.Auth.login 메서드를 찾을 수 없습니다.");return}e(!0);const p=new Promise((t,w)=>{g({scope:"profile_nickname,account_email,name,gender,age_range,phone_number",throughTalk:!1,success:async({access_token:c})=>{try{const i=S(),l=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:c})});if(!l.ok){const b=await l.json().catch(()=>({}));throw new Error(b.message||"Firebase 토큰 생성에 실패했습니다.")}const{firebaseToken:k}=await l.json();if(!k)throw new Error("서버로부터 Firebase 토큰을 받지 못했습니다.");const h=await j(E,k),K=await window.Kakao.API.request({url:"/v2/user/me"});await L(h.user,K),t(h)}catch(i){console.error("Login process failed:",i),w(i)}},fail:c=>{console.error("Kakao login failed:",c),w(new Error("카카오 인증에 실패했습니다."))}})});r.promise(p,{loading:"카카오 로그인 중...",success:"로그인 성공! 환영합니다.",error:t=>t.message||"알 수 없는 오류가 발생했습니다."}).finally(()=>{e(!1)})},f=n||a;return s.jsx("div",{className:"login-container",children:s.jsxs("div",{className:"login-box",children:[s.jsx("h2",{className:"title",children:"소도몰"}),s.jsx("p",{className:"subtitle",children:"소비자도 도매가로!"}),s.jsx("button",{className:"kakao-login-button",onClick:m,disabled:f,children:f?"준비 중...":"카카오로 시작하기"})]})})};export{P as default};
