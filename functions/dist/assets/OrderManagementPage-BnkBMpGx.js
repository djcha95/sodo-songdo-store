import{r as m,V as f,T as S,j as e,S as L,R as q}from"./index-BMz7zIRN.js";import{u as Q}from"./useDocumentTitle-BBAuQihd.js";import{u as _,b as F,t as G,d as K,e as V}from"./orderService-Bzti28Gn.js";import{f as W}from"./number-D3CZtsVU.js";import{Z as H}from"./zap-DEj6HJgU.js";import{S as Z}from"./search-C7k3Fw0J.js";import{F as X}from"./funnel-wB9N5xOV.js";import{S as z}from"./star-DZq8jtrE.js";import{A as C}from"./arrow-up-down-9iQe4W9e.js";import{T as B}from"./trash-2-C0X2zetg.js";import{P as T}from"./package-check-CP1CrOxf.js";import{c as $}from"./createLucideIcon-Df3tO_ja.js";import{C as Y}from"./clock-D_nK6rhO.js";import{P as J}from"./package-x-CNBULsdo.js";import{D as ee}from"./dollar-sign-DcMg-NJE.js";import{C as se}from"./chevrons-left-DkUsVS3s.js";import{C as te}from"./chevrons-right-B6gfhwfl.js";import{T as ae}from"./triangle-alert-DUarG1oM.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ne=$("badge-check",ie);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],ce=$("user-x",le),re=s=>!s||s.length<4?"-":s.slice(-4),A=s=>{if(!s||typeof s.toDate!="function")return"-";const n=s.toDate(),p=String(n.getFullYear()).slice(-2),j=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0"),k=String(n.getHours()).padStart(2,"0"),u=String(n.getMinutes()).padStart(2,"0");return`${p}.${j}.${r} ${k}:${u}`},oe=s=>{if(!s||!s.toDate)return"-";const n=s.toDate(),p=String(n.getMonth()+1).padStart(2,"0"),j=String(n.getDate()).padStart(2,"0"),r=["일","월","화","수","목","금","토"][n.getDay()];return`${p}/${j} (${r})`},de=s=>`${W(s)}원`,g={PICKED_UP:{label:"픽업 완료",icon:e.jsx(T,{size:14}),className:"status-picked-up",sortOrder:0},PREPAID:{label:"선입금",icon:e.jsx(ee,{size:14}),className:"status-prepaid",sortOrder:1},CANCELED:{label:"예약 취소",icon:e.jsx(J,{size:14}),className:"status-canceled",sortOrder:2},RESERVED:{label:"예약 확정",icon:e.jsx(Y,{size:14}),className:"status-reserved",sortOrder:3},NO_SHOW:{label:"노쇼",icon:e.jsx(ce,{size:14}),className:"status-no-show",sortOrder:4},COMPLETED:{label:"처리 완료",icon:e.jsx(T,{size:14}),className:"status-completed",sortOrder:5}},he=s=>{const n=new Date;return s.status==="PICKED_UP"&&s.pickedUpAt&&s.pickupDeadlineDate&&s.pickedUpAt instanceof S&&s.pickupDeadlineDate instanceof S&&s.pickedUpAt.toDate()>s.pickupDeadlineDate.toDate()?{...g.PICKED_UP,badge:e.jsxs("span",{className:"status-extra-badge late-pickup",children:[e.jsx(ne,{size:12})," 늦은 픽업"]})}:(s.status==="RESERVED"||s.status==="PREPAID")&&s.pickupDeadlineDate&&s.pickupDeadlineDate instanceof S&&s.pickupDeadlineDate.toDate()<n?{...g.NO_SHOW,badge:e.jsxs("span",{className:"status-extra-badge no-show-pending",children:[e.jsx(ae,{size:12})," 미수령"]})}:{...g[s.status],badge:null}},ue=({order:s,onSave:n})=>{const[p,j]=m.useState(!1),[r,k]=m.useState(s.notes||""),u=()=>{r!==s.notes&&n(s.id,r),j(!1)};return e.jsx("div",{className:"notes-display",onClick:()=>j(!0),children:p?e.jsx("textarea",{className:"notes-textarea",value:r,onChange:v=>k(v.target.value),onBlur:u,autoFocus:!0}):s.notes||e.jsx("span",{className:"notes-placeholder",children:"비고 입력..."})})},me=q.memo(({row:s,index:n,onStatusChange:p,onSaveNote:j,onToggleBookmark:r,onDeleteOrder:k})=>e.jsxs("tr",{className:s.isBookmarked?"bookmarked-row":"",children:[e.jsx("td",{className:"cell-center",children:n+1}),e.jsx("td",{children:A(s.createdAt)}),e.jsx("td",{children:s.customerName}),e.jsx("td",{className:"cell-center",children:re(s.customerPhone)}),e.jsx("td",{title:s.itemName,children:s.itemName}),e.jsx("td",{className:"cell-center",children:s.displayQuantity}),e.jsx("td",{className:"price-cell",children:de(s.subTotal)}),e.jsx("td",{children:oe(s.pickupDate)}),e.jsx("td",{children:A(s.pickedUpAt)}),e.jsx("td",{children:A(s.prepaidAt)}),e.jsx("td",{children:e.jsxs("div",{className:"status-cell-content",children:[e.jsx("select",{value:s.status,onChange:u=>p(s.originalOrder,u.target.value),className:`status-select ${g[s.status].className}`,children:Object.entries(g).map(([u,{label:v}])=>e.jsx("option",{value:u,children:v},u))}),he(s.originalOrder).badge]})}),e.jsx("td",{children:e.jsx(ue,{order:s.originalOrder,onSave:j})}),e.jsx("td",{className:"action-cell cell-center",children:e.jsx("button",{onClick:()=>r(s.originalOrder),className:`action-button bookmark-button ${s.isBookmarked?"bookmarked":""}`,title:"북마크",children:e.jsx(z,{size:16,fill:s.isBookmarked?"currentColor":"none"})})}),e.jsx("td",{className:"action-cell cell-center",children:e.jsx("button",{onClick:()=>k(s.originalOrder.id,s.customerName),className:"action-button delete-button",title:"예약 삭제",children:e.jsx(B,{size:16})})})]},s.uniqueRowKey)),pe=({currentPage:s,totalPages:n,onPageChange:p,itemsPerPage:j,onItemsPerPageChange:r,totalItems:k})=>{if(k===0)return null;const v=(()=>{const h=[],x=Math.floor(4);if(n<=10)for(let b=1;b<=n;b++)h.push(b);else{h.push(1),s>x+2&&h.push("...");let b=Math.max(2,s-x),w=Math.min(n-1,s+x);s<x+2&&(w=8),s>n-(x+1)&&(b=n-7);for(let N=b;N<=w;N++)h.push(N);s<n-(x+1)&&h.push("..."),h.push(n)}return h})();return e.jsxs("div",{className:"pagination-container",children:[e.jsx("div",{className:"pagination-left",children:e.jsxs("div",{className:"items-per-page-selector",children:[e.jsx("label",{htmlFor:"itemsPerPage",children:"표시 개수:"}),e.jsxs("select",{id:"itemsPerPage",value:j,onChange:r,children:[e.jsx("option",{value:20,children:"20개"}),e.jsx("option",{value:50,children:"50개"}),e.jsx("option",{value:100,children:"100개"})]})]})}),e.jsxs("div",{className:"pagination-center",children:[e.jsx("button",{onClick:()=>p(1),disabled:s===1,title:"첫 페이지",children:e.jsx(se,{size:16})}),e.jsx("button",{onClick:()=>p(s-1),disabled:s===1,title:"이전 페이지",children:"이전"}),v.map((h,D)=>typeof h=="number"?e.jsx("button",{onClick:()=>p(h),className:s===h?"active":"",children:h},D):e.jsx("span",{className:"pagination-ellipsis",children:h},D)),e.jsx("button",{onClick:()=>p(s+1),disabled:s===n,title:"다음 페이지",children:"다음"}),e.jsx("button",{onClick:()=>p(n),disabled:s===n,title:"마지막 페이지",children:e.jsx(te,{size:16})})]}),e.jsx("div",{className:"pagination-right",children:e.jsxs("span",{className:"total-items-display",children:["총 ",k,"건"]})})]})},Be=()=>{Q("예약 통합 관리");const[s,n]=m.useState([]),[p,j]=m.useState(!0),[r,k]=m.useState({status:"all",searchQuery:"",showBookmarkedOnly:!1}),[u,v]=m.useState({key:"createdAt",direction:"desc"}),[h,D]=m.useState(1),[x,b]=m.useState(20);m.useEffect(()=>{(async()=>{j(!0);try{const l=await K();n(l)}catch{f.error("예약 목록을 불러오는 중 오류가 발생했습니다.")}finally{j(!1)}})()},[]),m.useEffect(()=>{D(1)},[r,x]);const w=a=>{const{name:l,value:t,type:i}=a.target;if(i==="checkbox"){const{checked:c}=a.target;k(o=>({...o,[l]:c}))}else k(c=>({...c,[l]:t}))},N=a=>{let l="asc";u&&u.key===a&&u.direction==="asc"&&(l="desc"),v({key:a,direction:l})},I=m.useCallback(async(a,l)=>{if(a.status===l)return;const t={...a},i={...a,status:l};n(o=>o.map(d=>d.id===a.id?i:d));const c=f.loading(`${a.customerInfo.name}님의 주문 처리 중...`);try{await _([a.id],l),f.success("성공적으로 처리되었습니다.",{id:c})}catch{n(d=>d.map(y=>y.id===a.id?t:y)),f.error("처리 중 오류가 발생했습니다.",{id:c})}},[]),M=m.useCallback((a,l)=>{f(t=>e.jsxs("div",{className:"custom-toast-container",children:[e.jsxs("p",{className:"toast-message",children:[e.jsx("b",{children:l}),"님의 예약을",e.jsx("br",{}),"정말 삭제하시겠습니까?"]}),e.jsxs("div",{className:"toast-button-group",children:[e.jsx("button",{className:"toast-button toast-button-cancel",onClick:()=>f.dismiss(t.id),children:"취소"}),e.jsx("button",{className:"toast-button toast-button-confirm",onClick:()=>{f.dismiss(t.id);const i=async()=>await V(a);f.promise(i(),{loading:"예약 삭제 중...",success:()=>(n(c=>c.filter(o=>o.id!==a)),"예약이 성공적으로 삭제되었습니다."),error:()=>"예약 삭제에 실패했습니다."})},children:"삭제"})]})]}),{duration:6e3,position:"top-center"})},[]),R=m.useCallback(async(a,l)=>{const t=s.find(i=>i.id===a)?.notes||"";n(i=>i.map(c=>c.id===a?{...c,notes:l}:c));try{await f.promise(F(a,l),{loading:"메모 저장 중...",success:"메모가 저장되었습니다.",error:"메모 저장에 실패했습니다."})}catch{n(c=>c.map(o=>o.id===a?{...o,notes:t}:o))}},[s]),P=m.useCallback(async a=>{const l=!a.isBookmarked;n(t=>t.map(i=>i.id===a.id?{...i,isBookmarked:l}:i));try{await G(a.id,l)}catch{f.error("북마크 변경에 실패했습니다."),n(i=>i.map(c=>c.id===a.id?{...c,isBookmarked:!l}:c))}},[]),O=m.useMemo(()=>{const a=s.filter(t=>{const i=r.status==="all"||t.status===r.status,c=r.searchQuery===""||t.customerInfo.name.toLowerCase().includes(r.searchQuery.toLowerCase())||t.customerInfo.phone&&t.customerInfo.phone.includes(r.searchQuery)||(t.items||[]).some(d=>d.productName&&d.productName.toLowerCase().includes(r.searchQuery.toLowerCase())||d.itemName&&d.itemName.toLowerCase().includes(r.searchQuery.toLowerCase())||d.variantGroupName&&d.variantGroupName.toLowerCase().includes(r.searchQuery.toLowerCase())),o=!r.showBookmarkedOnly||t.isBookmarked;return i&&c&&o}),l=[];return a.forEach(t=>{(t.items||[]).forEach((i,c)=>{let o=i.productName||"";i.variantGroupName&&i.variantGroupName!==i.productName&&(o+=` - ${i.variantGroupName}`),i.itemName&&(o+=` (${i.itemName})`);let d=`${i.quantity}`;const y=i.stockDeductionAmount||1;if(y>1){const U=i.quantity*y;d=`${i.quantity}(${U})`}l.push({orderId:t.id,isBookmarked:t.isBookmarked||!1,createdAt:t.createdAt instanceof S?t.createdAt:null,customerName:t.customerInfo.name,customerPhone:t.customerInfo.phone||null,itemName:o.trim(),quantity:i.quantity,displayQuantity:d,subTotal:i.unitPrice*i.quantity,pickupDate:t.pickupDate instanceof S?t.pickupDate:null,pickedUpAt:t.pickedUpAt instanceof S?t.pickedUpAt:null,prepaidAt:t.prepaidAt instanceof S?t.prepaidAt:null,status:t.status,notes:t.notes||"",originalOrder:t,uniqueRowKey:`${t.id}-${i.itemId||c}`})})}),u!==null&&l.sort((t,i)=>{let c,o;const{key:d,direction:y}=u;return d==="status"?(c=g[t.status]?.sortOrder??99,o=g[i.status]?.sortOrder??99):d==="customerName"?(c=t.customerName,o=i.customerName):["createdAt","pickupDate","pickedUpAt","prepaidAt"].includes(d)?(c=t[d]?.toMillis()||0,o=i[d]?.toMillis()||0):(c=t[d],o=i[d]),c<o?y==="asc"?-1:1:c>o?y==="asc"?1:-1:0}),l},[s,r,u]),E=m.useMemo(()=>{const a=(h-1)*x,l=a+x;return O.slice(a,l)},[O,h,x]);return p?e.jsx(L,{message:"예약 목록을 불러오는 중..."}):e.jsxs("div",{className:"admin-page-container order-management-container",children:[e.jsxs("header",{className:"admin-page-header",children:[e.jsx("h1",{className:"admin-page-title",children:"예약 통합 관리"}),e.jsxs("button",{className:"quick-check-button",children:[e.jsx(H,{size:16}),"빠른 예약확인"]})]}),e.jsxs("div",{className:"list-controls-v3",children:[e.jsxs("div",{className:"search-bar-wrapper-v2",children:[e.jsx(Z,{size:20,className:"search-icon-v2"}),e.jsx("input",{type:"text",name:"searchQuery",placeholder:"고객명, 전화번호, 품목으로 검색...",value:r.searchQuery,onChange:w,className:"search-input-v2"})]}),e.jsxs("div",{className:"filter-sort-wrapper",children:[e.jsxs("div",{className:"control-group-v2",children:[e.jsx(X,{size:16}),e.jsxs("select",{name:"status",value:r.status,onChange:w,className:"control-select-v2",children:[e.jsx("option",{value:"all",children:"모든 상태"}),Object.entries(g).map(([a,{label:l}])=>e.jsx("option",{value:a,children:l},a))]})]}),e.jsxs("label",{className:"bookmark-filter-label",children:[e.jsx("input",{type:"checkbox",name:"showBookmarkedOnly",checked:r.showBookmarkedOnly,onChange:w}),e.jsx(z,{size:14,className:"bookmark-icon-label",fill:r.showBookmarkedOnly?"currentColor":"none"}),"북마크만"]})]})]}),e.jsx("div",{className:"admin-table-container",children:e.jsxs("table",{className:"admin-table excel-style",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"cell-center",style:{width:"var(--table-col-번호-width)"},children:"No"}),e.jsx("th",{style:{width:"var(--table-col-주문일시-width)"},children:e.jsxs("div",{className:"sortable-header",onClick:()=>N("createdAt"),children:[e.jsx("span",{children:"예약일시"}),e.jsx(C,{size:12})]})}),e.jsx("th",{style:{width:"var(--table-col-고객명-width)"},children:e.jsxs("div",{className:"sortable-header",onClick:()=>N("customerName"),children:[e.jsx("span",{children:"고객명"}),e.jsx(C,{size:12})]})}),e.jsx("th",{className:"cell-center",style:{width:"var(--table-col-전화번호-width)"},children:"전화번호"}),e.jsx("th",{style:{width:"var(--table-col-품목-width)"},children:"품목"}),e.jsx("th",{className:"cell-center",style:{width:"var(--table-col-수량-width)"},children:"수량"}),e.jsx("th",{style:{width:"var(--table-col-합계-width)"},children:e.jsxs("div",{className:"sortable-header",onClick:()=>N("subTotal"),children:[e.jsx("span",{children:"합계"}),e.jsx(C,{size:12})]})}),e.jsx("th",{style:{width:"var(--table-col-픽업일-width)"},children:e.jsxs("div",{className:"sortable-header",onClick:()=>N("pickupDate"),children:[e.jsx("span",{children:"픽업일"}),e.jsx(C,{size:12})]})}),e.jsx("th",{style:{width:"var(--table-col-완료시각-width)"},children:e.jsxs("div",{className:"sortable-header",onClick:()=>N("pickedUpAt"),children:[e.jsx("span",{children:"완료시각"}),e.jsx(C,{size:12})]})}),e.jsx("th",{style:{width:"var(--table-col-선입금-width)"},children:e.jsxs("div",{className:"sortable-header",onClick:()=>N("prepaidAt"),children:[e.jsx("span",{children:"선입금 처리"}),e.jsx(C,{size:12})]})}),e.jsx("th",{style:{width:"var(--table-col-상태-width)"},children:e.jsxs("div",{className:"sortable-header",onClick:()=>N("status"),children:[e.jsx("span",{children:"상태"}),e.jsx(C,{size:12})]})}),e.jsx("th",{style:{width:"var(--table-col-비고-width)"},children:"비고"}),e.jsx("th",{className:"cell-center",style:{width:"var(--table-col-북마크-width)"},title:"북마크",children:e.jsx(z,{size:16})}),e.jsx("th",{className:"cell-center",style:{width:"var(--table-col-삭제-width)"},title:"삭제",children:e.jsx(B,{size:16})})]})}),e.jsx("tbody",{children:E.length>0?E.map((a,l)=>e.jsx(me,{row:a,index:(h-1)*x+l,onStatusChange:I,onSaveNote:R,onToggleBookmark:P,onDeleteOrder:M},a.uniqueRowKey)):e.jsx("tr",{children:e.jsx("td",{colSpan:15,className:"no-results-cell",children:"표시할 예약이 없습니다."})})})]})}),e.jsx(pe,{currentPage:h,totalPages:Math.ceil(O.length/x),onPageChange:D,itemsPerPage:x,onItemsPerPageChange:a=>b(Number(a.target.value)),totalItems:O.length})]})};export{Be as default};
