import{r as c,a4 as T,at as $,V as i,j as e,S as k,au as A,av as G,aw as I,ax as O}from"./index-BMz7zIRN.js";import{u as V}from"./useDocumentTitle-BBAuQihd.js";import{D as B,C as L,P as M}from"./react-beautiful-dnd.esm-BdJ2y8EP.js";import{C as Y}from"./circle-plus-DMyLxw0U.js";import{G as q}from"./grip-vertical-DMFS8ejR.js";import{C as F}from"./check-6pj1M3ks.js";import{X as H}from"./x-BfIBbJBP.js";import{S as U}from"./square-pen-CwtIThVX.js";import{T as X}from"./trash-2-C0X2zetg.js";import"./createLucideIcon-Df3tO_ja.js";const te=()=>{V("카테고리 관리");const[d,p]=c.useState([]),[h,D]=c.useState({}),[x,f]=c.useState(""),[C,m]=c.useState(null),[j,u]=c.useState(""),[o,b]=c.useState(!0),[y,N]=c.useState(null);c.useEffect(()=>{g()},[]);const g=async()=>{b(!0),N(null);try{const[s,r]=await Promise.all([T(),$()]);p(s),D(r)}catch(s){console.error("데이터 불러오기 오류:",s),N("카테고리 정보를 불러오는 데 실패했습니다."),i.error("데이터를 불러오는 데 실패했습니다.")}finally{b(!1)}},P=async s=>{s.preventDefault();const r=x.trim();if(!r){i.error("카테고리 이름을 입력해주세요.");return}if(d.some(a=>a.name===r)){i.error("이미 존재하는 카테고리 이름입니다.");return}const n=new Promise(async(a,l)=>{try{const t={name:r,order:d.length};await A(t),f(""),await g(),a()}catch(t){console.error("카테고리 추가 오류:",t),l(t)}});i.promise(n,{loading:"카테고리 추가 중...",success:`'${r}' 카테고리가 추가되었습니다.`,error:"카테고리 추가에 실패했습니다."})},E=async s=>{const r=h[s.name]||0,n=r>0?`이 카테고리에는 ${r}개의 상품이 포함되어 있습니다. 정말 삭제하시겠습니까?
포함된 상품들은 '분류 없음' 상태가 됩니다.`:`"${s.name}" 카테고리를 삭제하시겠습니까?`;if(!window.confirm(n))return;const a=new Promise(async(l,t)=>{try{await O(s.id,s.name),await g(),m(null),l()}catch(S){console.error("카테고리 삭제 오류:",S),t(S)}});i.promise(a,{loading:"카테고리 삭제 중...",success:`'${s.name}' 카테고리가 삭제되었습니다.`,error:"카테고리 삭제에 실패했습니다."})},v=s=>{const{source:r,destination:n}=s;if(!n||s.type!=="CATEGORY")return;const a=Array.from(d),[l]=a.splice(r.index,1);a.splice(n.index,0,l),p(a);const t=G(a);i.promise(t,{loading:"순서 저장 중...",success:"카테고리 순서가 저장되었습니다.",error:"순서 저장에 실패했습니다."})},z=s=>{m(s.id),u(s.name)},w=async s=>{const r=j.trim();if(!r){i.error("카테고리 이름을 입력해주세요.");return}if(d.some(a=>a.name===r&&a.id!==s)){i.error("이미 존재하는 카테고리 이름입니다.");return}const n=I(s,{name:r}).then(()=>{m(null),u(""),g()});i.promise(n,{loading:"수정 중...",success:"이름이 수정되었습니다.",error:"수정 실패"})},R=()=>{m(null),u("")};return e.jsxs("div",{className:"category-management-container",children:[o&&e.jsx(k,{message:"데이터 처리 중..."}),y&&e.jsx("div",{className:"error-message-banner",children:y}),e.jsxs("div",{className:"category-form-section section-card",children:[e.jsx("h3",{children:"새 카테고리 추가"}),e.jsxs("form",{onSubmit:P,className:"category-form",children:[e.jsx("input",{type:"text",value:x,onChange:s=>f(s.target.value),placeholder:"새 카테고리 이름",disabled:o}),e.jsxs("button",{type:"submit",disabled:o,children:[e.jsx(Y,{size:20})," 추가"]})]})]}),e.jsx(B,{onDragEnd:v,children:e.jsxs("div",{className:"category-list-section section-card",children:[e.jsx("h3",{children:"카테고리 목록 (드래그하여 순서 변경)"}),d.length>0?e.jsx(L,{droppableId:"categories",type:"CATEGORY",children:s=>e.jsxs("ul",{className:"category-list",...s.droppableProps,ref:s.innerRef,children:[d.map((r,n)=>e.jsx(M,{draggableId:r.id,index:n,children:(a,l)=>e.jsx("li",{ref:a.innerRef,...a.draggableProps,className:`category-item ${l.isDragging?"dragging":""}`,children:e.jsxs("div",{className:"category-main-row",children:[e.jsx("div",{...a.dragHandleProps,className:"drag-handle",children:e.jsx(q,{size:20})}),C===r.id?e.jsxs("form",{onSubmit:t=>{t.preventDefault(),w(r.id)},className:"inline-edit-form",children:[e.jsx("input",{type:"text",value:j,onChange:t=>u(t.target.value),onBlur:()=>w(r.id),autoFocus:!0,disabled:o}),e.jsx("button",{type:"submit",disabled:o,children:e.jsx(F,{size:20})}),e.jsx("button",{type:"button",onClick:R,disabled:o,children:e.jsx(H,{size:20})})]}):e.jsxs("span",{className:"category-name-display",children:[r.name," (",h[r.name]||0,")"]}),e.jsxs("div",{className:"category-actions",children:[C!==r.id&&e.jsx("button",{onClick:()=>z(r),disabled:o,className:"icon-btn",children:e.jsx(U,{size:18})}),e.jsx("button",{onClick:()=>E(r),disabled:o,className:"icon-btn trash-btn",children:e.jsx(X,{size:18})})]})]})})},r.id)),s.placeholder]})}):!o&&e.jsx("p",{className:"no-data-message",children:"등록된 카테고리가 없습니다. 위 폼을 통해 추가해주세요."})]})})]})};export{te as default};
