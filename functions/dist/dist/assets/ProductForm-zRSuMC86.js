import{u as dt,r,a4 as Fe,V as x,a9 as ut,j as e,S as Be,t as pt,T as q,aa as mt,ab as ht,ac as xt,ad as gt,l as ft,q as jt}from"./index-BMz7zIRN.js";import{D as Nt,C as bt,P as yt}from"./react-beautiful-dnd.esm-BdJ2y8EP.js";import{I as Dt}from"./InlineSodomallLoader-CN_E-RXV.js";import{i as ge}from"./tippy-BL_pV7HH.js";import{p as kt,f as vt}from"./number-D3CZtsVU.js";import{r as fe}from"./logger-CZyc96rC.js";import{c as De}from"./createLucideIcon-Df3tO_ja.js";import{S as Ee}from"./save-B2IXE8Sx.js";import{P as wt}from"./package-CR9FldPL.js";import{L as qe}from"./loader-circle-B7eOStzy.js";import{T as Ct}from"./triangle-alert-DUarG1oM.js";import{X as Qe}from"./x-BfIBbJBP.js";import{C as Tt}from"./circle-plus-DMyLxw0U.js";import{B as Pt,L as Rt}from"./lock-Cxol5EeZ.js";import{T as He}from"./trash-2-C0X2zetg.js";import{S as be}from"./sliders-horizontal-DyKEv-NS.js";import{I as ye}from"./info-DxE8bBlt.js";import{C as It}from"./clock-D_nK6rhO.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]],At=De("bot",St);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=[["path",{d:"M16 19h6",key:"xwg31i"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M19 16v6",key:"tddt3s"}],["path",{d:"M21 12.598V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8.5",key:"1glfrc"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 2v4",key:"1cmpym"}]],Ot=De("calendar-plus",Mt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Ut=De("file-text",zt),R=a=>a?new Date(a.getTime()-a.getTimezoneOffset()*6e4).toISOString().slice(0,10):"",Ve=a=>a?new Date(a.getTime()-a.getTimezoneOffset()*6e4).toISOString().slice(0,16):"",ee=a=>a?new Date(`${a}T00:00:00`):null,b=()=>Math.random().toString(36).substring(2,11),je=a=>{if(!a)return null;let m=new Date(a);if(!isNaN(m.getTime())&&m.getFullYear()>1970)return m;const g=a.replace(/[^0-9]/g,"");let j,y,I;if(g.length===6)j=parseInt("20"+g.substring(0,2),10),y=parseInt(g.substring(2,4),10)-1,I=parseInt(g.substring(4,6),10);else if(g.length===8)j=parseInt(g.substring(0,4),10),y=parseInt(g.substring(4,6),10)-1,I=parseInt(g.substring(6,8),10);else return null;return m=new Date(j,y,I),m.getFullYear()===j&&m.getMonth()===y&&m.getDate()===I?m:null},E=a=>{if(!a)return null;if(a instanceof Date)return a;if(typeof a.toDate=="function")return a.toDate();if(typeof a=="object"&&a.seconds!==void 0&&a.nanoseconds!==void 0)return new q(a.seconds,a.nanoseconds).toDate();const m=new Date(a);return isNaN(m.getTime())?null:m},$t=[{key:"ROOM",name:"실온",className:"storage-btn-room"},{key:"FROZEN",name:"냉동",className:"storage-btn-frozen"},{key:"COLD",name:"냉장",className:"storage-btn-cold"}],Ne=["묶음","박스","곽","세트","팩","봉지"],Lt=["개","병","잔","포","장","통","회","g","kg","ml","l","낱개"],Gt=5*1024*1024,te=["공구의 신","공구왕","공구요정","공구새싹"],Ft=({isOpen:a,onClose:m,isPreOrderEnabled:g,setIsPreOrderEnabled:j,preOrderTiers:y,setPreOrderTiers:I,isSecretProductEnabled:H,setIsSecretProductEnabled:W,secretTiers:z,setSecretTiers:S})=>{if(!a)return null;const se=d=>{I(D=>D.includes(d)?D.filter(f=>f!==d):[...D,d])},U=d=>{S(D=>D.includes(d)?D.filter(f=>f!==d):[...D,d])};return e.jsx("div",{className:"admin-modal-overlay",onClick:m,children:e.jsxs("div",{className:"admin-modal-content",onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"admin-modal-header",children:[e.jsxs("h4",{children:[e.jsx(be,{size:20})," 등급별 판매 설정"]}),e.jsx("button",{onClick:m,className:"admin-modal-close-button",children:e.jsx(Qe,{size:24})})]}),e.jsxs("div",{className:"admin-modal-body",children:[e.jsxs("div",{className:"form-group",style:{marginBottom:"24px"},children:[e.jsxs("label",{className:"preorder-toggle-label",children:[e.jsxs("span",{children:[e.jsx(It,{size:16})," 선주문 기능 사용"]}),e.jsx("div",{className:`toggle-switch ${g?"active":""}`,onClick:()=>j(!g),children:e.jsx("div",{className:"toggle-handle"})})]}),g&&e.jsxs("div",{className:"preorder-options active",children:[e.jsxs("p",{className:"preorder-info",children:[e.jsx(ye,{size:14}),"선택된 등급은 상품 발행일 오후 2시까지 선주문이 가능합니다."]}),e.jsx("div",{className:"tier-checkbox-group",children:te.map(d=>e.jsxs("label",{htmlFor:`preorder-tier-${d}`,children:[e.jsx("input",{type:"checkbox",id:`preorder-tier-${d}`,value:d,checked:y.includes(d),onChange:()=>se(d)}),d]},`preorder-${d}`))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{className:"preorder-toggle-label",children:[e.jsxs("span",{children:[e.jsx(Rt,{size:16})," 시크릿 상품 (등급 제한)"]}),e.jsx("div",{className:`toggle-switch ${H?"active":""}`,onClick:()=>W(!H),children:e.jsx("div",{className:"toggle-handle"})})]}),H&&e.jsxs("div",{className:"preorder-options active",children:[e.jsxs("p",{className:"preorder-info",children:[e.jsx(ye,{size:14}),"선택된 등급의 고객에게만 이 상품이 노출됩니다."]}),e.jsx("div",{className:"tier-checkbox-group",children:te.map(d=>e.jsxs("label",{htmlFor:`secret-tier-${d}`,children:[e.jsx("input",{type:"checkbox",id:`secret-tier-${d}`,value:d,checked:z.includes(d),onChange:()=>U(d)}),d]},`secret-${d}`))})]})]})]}),e.jsx("div",{className:"admin-modal-footer",children:e.jsx("button",{onClick:m,className:"modal-button primary",children:"확인"})})]})})},is=({mode:a,productId:m,roundId:g,initialState:j})=>{const y=dt(),I=r.useRef(null),[H,W]=r.useState(a==="editRound"||a==="newRound"),[z,S]=r.useState(!1),[se,U]=r.useState("새 상품 등록"),[d,D]=r.useState("신규 상품 등록하기"),[f,Y]=r.useState("single"),[$,_e]=r.useState([]),[C,K]=r.useState(""),[V,ae]=r.useState(""),[ne,ie]=r.useState(""),[L,re]=r.useState("ROOM"),[ke,ve]=r.useState(new Date),[We,Ye]=r.useState([]),[Ke,le]=r.useState([]),[Ze,we]=r.useState([]),[T,Z]=r.useState([]),[G,Ce]=r.useState(new Map),[Te,X]=r.useState("1차 판매"),[k,N]=r.useState([]),[F,Pe]=r.useState(()=>new Date(new Date().setHours(14,0,0,0))),[A,oe]=r.useState(null),[v,ce]=r.useState(null),[M,J]=r.useState(null),[de,Re]=r.useState(!1),[Xe,Ie]=r.useState(!1),[ue,Se]=r.useState(!0),[pe,Ae]=r.useState(["공구의 신","공구왕"]),[B,Me]=r.useState(!1),[Q,Oe]=r.useState([]),[ze,Ue]=r.useState([]),[Je,$e]=r.useState(!1),[me,he]=r.useState(!1);r.useEffect(()=>{switch(a){case"newProduct":U("신규 대표 상품 등록"),D("신규 상품 등록하기"),j?.productGroupName&&(K(j.productGroupName),N(t=>{const s=[...t];return s[0]&&(s[0].groupName=j.productGroupName),s}));break;case"newRound":U(`'${j?.productGroupName||""}' 새 회차 추가`),D("새 회차 추가하기");break;case"editRound":U("판매 회차 수정"),D("수정 내용 저장");break}},[a,j?.productGroupName]),r.useEffect(()=>{(a==="editRound"||a==="newRound")&&(async()=>{if(m){W(!0);try{const s=await pt(m);if(!s){x.error("상품을 찾을 수 없습니다."),y("/admin/products");return}K(s.groupName),ae(s.description),re(s.storageType),s.createdAt&&ve(E(s.createdAt)||new Date);const i=(await Fe()).find(n=>n.name===s.category);i&&ie(i.id),Ye(s.imageUrls||[]),le(s.imageUrls||[]),Z(s.imageUrls||[]);let l;if(a==="editRound"&&g){if(l=s.salesHistory.find(n=>n.roundId===g),!l){x.error("판매 회차를 찾을 수 없습니다."),y(`/admin/products/edit/${m}`);return}U(`'${s.groupName}' 회차 수정`)}else if(a==="newRound")if(l=j?.lastRound||s.salesHistory[0],l){const n=l.roundName.match(/\d+/),o=n?parseInt(n[0],10)+1:s.salesHistory.length+1;X(`${o}차 판매`)}else X("1차 판매");if(l){const n=l;a==="editRound"&&X(n.roundName),Y((n.variantGroups?.length||0)>1||n.variantGroups?.[0]?.groupName!==s.groupName?"group":"single");const o=(n.variantGroups||[]).map(u=>{const p=E(u.items[0]?.expirationDate);return{id:b(),groupName:u.groupName,totalPhysicalStock:u.totalPhysicalStock??"",stockUnitType:u.stockUnitType,expirationDate:p,expirationDateInput:p?R(p):"",items:(u.items||[]).map(h=>({id:b(),name:h.name,price:h.price,limitQuantity:h.limitQuantity??"",deductionAmount:h.stockDeductionAmount,isBundleOption:Ne.some(O=>h.name.includes(O))}))}});N(o),a==="editRound"&&(Pe(E(n.publishAt)||new Date),oe(E(n.deadlineDate)),ce(E(n.pickupDate)),J(E(n.pickupDeadlineDate))),Re(n.isPrepaymentRequired??!1),Se(n.preOrderTiers?n.preOrderTiers.length>0:!0),Ae(n.preOrderTiers||["공구의 신","공구왕"]);const c=n.allowedTiers?.filter(u=>u!=="주의 요망");Me(!!c&&c.length<te.length),Oe(c||[])}}catch(s){fe("ProductForm.fetchData",s),x.error("양식 데이터를 불러오는 데 실패했습니다.")}finally{W(!1)}}})()},[a,m,g,y,j]),r.useEffect(()=>{Fe().then(_e).catch(()=>x.error("카테고리 정보를 불러오는 데 실패했습니다.")),a==="newProduct"&&k.length===0&&N([{id:b(),groupName:"",totalPhysicalStock:"",stockUnitType:"개",expirationDate:null,expirationDateInput:"",items:[{id:b(),name:"",price:"",limitQuantity:"",deductionAmount:1,isBundleOption:!1}]}])},[a,k.length]),r.useEffect(()=>{if(a==="editRound")return;const t=new Date(F),s=t.getDay();s===6?t.setDate(t.getDate()+2):t.setDate(t.getDate()+1),t.setHours(13,0,0,0),oe(t)},[F,a]),r.useEffect(()=>{if(!v){J(null);return}const t=new Date(v);(L==="ROOM"||L==="FROZEN")&&t.setDate(t.getDate()+1),t.setHours(13,0,0,0),J(t)},[v,L]),r.useEffect(()=>{f==="single"&&k.length>0&&N(t=>{const s=t[0];if(s&&s.groupName!==C){const i=[...t];return i[0]={...s,groupName:C},i}return t})},[C,f]),r.useEffect(()=>{if(a!=="newProduct"||!C.trim()){Ue([]);return}const t=setTimeout(async()=>{$e(!0);try{Ue(await ut(C.trim()))}catch(s){fe("ProductForm.searchProductsByName",s)}finally{$e(!1)}},500);return()=>clearTimeout(t)},[C,a]);const Le=r.useCallback(t=>{f!==t&&(f==="group"&&t==="single"?x.promise(new Promise(s=>{setTimeout(()=>{N(i=>i.slice(0,1)),Y(t),s()},300)}),{loading:"변경 중...",success:"단일 상품으로 전환되었습니다.",error:"전환 실패"}):Y(t))},[f]),P=r.useCallback((t,s,i)=>{N(l=>l.map(n=>n.id===t?{...n,[s]:i}:n))},[]),et=r.useCallback((t,s)=>{if(!s.trim()){P(t,"expirationDate",null),P(t,"expirationDateInput","");return}const i=je(s);i?(P(t,"expirationDate",i),P(t,"expirationDateInput",R(i))):(x.error("유효하지 않은 날짜 형식입니다. (예: 250809 또는 2025-08-09)"),P(t,"expirationDate",null),P(t,"expirationDateInput",s))},[P]),tt=r.useCallback(()=>{N(t=>[...t,{id:b(),groupName:"",totalPhysicalStock:"",stockUnitType:"개",expirationDate:null,expirationDateInput:"",items:[{id:b(),name:"",price:"",limitQuantity:"",deductionAmount:1,isBundleOption:!1}]}])},[]),st=r.useCallback(t=>{k.length>1?N(s=>s.filter(i=>i.id!==t)):x.error("최소 1개의 하위 그룹이 필요합니다.")},[k.length]),xe=r.useCallback((t,s,i,l)=>{N(n=>n.map(o=>o.id===t?{...o,items:o.items.map(c=>{if(c.id!==s)return c;const u={...c,[i]:l};if(i==="name"){const p=Ne.some(h=>String(l).includes(h))||!Lt.some(h=>String(l).includes(h));u.isBundleOption=p,u.deductionAmount=p?c.deductionAmount:1}return u})}:o))},[]),at=r.useCallback((t,s,i)=>{const l=kt(i);N(n=>n.map(o=>o.id===t?{...o,items:o.items.map(c=>c.id===s?{...c,price:l}:c)}:o))},[]),nt=r.useCallback(t=>{N(s=>s.map(i=>i.id===t?{...i,items:[...i.items,{id:b(),name:"",price:"",limitQuantity:"",deductionAmount:1,isBundleOption:!1}]}:i))},[]),it=r.useCallback((t,s)=>{N(i=>i.map(l=>l.id===t&&l.items.length>1?{...l,items:l.items.filter(n=>n.id!==s)}:l))},[]),rt=r.useCallback(t=>{if(!t.target.files)return;const s=Array.from(t.target.files).filter(i=>i.size>Gt?(x.error(`'${i.name}' 파일 크기가 너무 큽니다 (최대 5MB).`),!1):!0);we(i=>[...i,...s]),Z(i=>{const l=[...i],n=new Map(G);return s.forEach(o=>{const c=URL.createObjectURL(o);l.push(c),n.set(c,o)}),Ce(n),l}),t.target.value=""},[G]),lt=r.useCallback(t=>{const s=T[t];if(s){if(s.startsWith("blob:")){const i=G.get(s)||null;if(i){we(n=>n.filter(o=>o!==i));const l=new Map(G);l.delete(s),Ce(l)}URL.revokeObjectURL(s)}else le(i=>i.filter(l=>l!==s));Z(i=>i.filter((l,n)=>n!==t))}},[T,G]),ot=t=>{if(!t.destination)return;const{source:s,destination:i}=t,l=Array.from(T),[n]=l.splice(s.index,1);if(l.splice(i.index,0,n),Z(l),a==="editRound"){const o=Array.from(Ke),[c]=o.splice(s.index,1);typeof c<"u"&&(o.splice(i.index,0,c),le(o))}},ct=async()=>{if(!V.trim()){x.error("먼저 상세 설명란에 분석할 내용을 붙여넣어 주세요.");return}he(!0);const t=ft(jt,"analyzeProductTextWithAI"),s=$.map(l=>l.name),i=t({text:V,categories:s});x.promise(i,{loading:"AI가 상품 정보를 분석하고 있습니다...",success:l=>{const n=l.data;if(n.groupName&&K(n.groupName),n.cleanedDescription&&ae(n.cleanedDescription),n.storageType&&re(n.storageType),n.productType&&Y(n.productType),n.categoryName&&$.length>0){const c=$.find(u=>u.name===n.categoryName);c?(ie(c.id),x.success(`'${c.name}' 카테고리가 자동으로 선택되었습니다.`)):x.error(`AI가 추천한 '${n.categoryName}' 카테고리를 찾을 수 없습니다.`)}const o=n.variantGroups?.[0];if(o?.pickupDate&&ce(je(o.pickupDate)),n.variantGroups&&n.variantGroups.length>0){const c=n.variantGroups.map(u=>{const p=je(u.expirationDate),h=(u.items||[]).map(O=>({id:b(),name:O.name,price:O.price||"",limitQuantity:"",deductionAmount:1,isBundleOption:Ne.some(w=>O.name.includes(w))}));return h.length===0&&h.push({id:b(),name:"",price:"",limitQuantity:"",deductionAmount:1,isBundleOption:!1}),{id:b(),groupName:u.groupName||n.groupName||"",totalPhysicalStock:u.totalPhysicalStock??"",stockUnitType:"개",expirationDate:p,expirationDateInput:p?R(p):u.expirationDate||"",items:h}});N(c)}else N([{id:b(),groupName:n.groupName||"",totalPhysicalStock:"",stockUnitType:"개",expirationDate:null,expirationDateInput:"",items:[{id:b(),name:"",price:"",limitQuantity:"",deductionAmount:1,isBundleOption:!1}]}]);return he(!1),"AI 분석 완료! 자동으로 입력된 내용을 확인해주세요."},error:l=>{he(!1),fe("ProductForm.handleAIParse",l);const n=l.message||"AI 분석 중 알 수 없는 오류가 발생했습니다.";return n.includes("failed-precondition")?"AI 서비스 설정에 문제가 있습니다. 관리자에게 문의하세요.":n}})},_=r.useMemo(()=>{const t=new Date(F);t.setHours(14,0,0,0);const s=`${R(t)} 오후 2시`,i=A?Ve(A).replace("T"," "):"미설정",l=v?R(v):"미설정",n=M?R(M):"미설정",o=B?`${Q.join(", ")} 등급만`:"모두 참여 가능";return{publishText:s,deadlineText:i,pickupText:l,pickupDeadlineText:n,participationText:o}},[F,A,v,M,B,Q]),Ge=async(t=!1)=>{S(!0);const s=2020,i=2100,l=(o,c)=>{if(!o)return!0;const u=o.getFullYear(),p=u>=s&&u<=i;return p||x.error(`${c}의 날짜(${u}년)가 유효한 범위를 벗어났습니다. 다시 확인해주세요.`),p},n=[{date:A,name:"공동구매 마감일"},{date:v,name:"픽업 시작일"},{date:M,name:"픽업 마감일"},...k.map((o,c)=>({date:o.expirationDate,name:`옵션 ${c+1}의 유통기한`}))];for(const{date:o,name:c}of n)if(!l(o,c)){S(!1);return}if(!t){if(a!=="newRound"&&T.length===0){x.error("대표 이미지를 1개 이상 등록해주세요."),S(!1);return}if(!A||!v||!M){x.error("공구 마감일, 픽업 시작일, 픽업 마감일을 모두 설정해주세요."),S(!1);return}if(B&&Q.length===0){x.error("시크릿 상품을 활성화했습니다. 참여 가능한 등급을 1개 이상 선택해주세요."),S(!1);return}}try{const o=t?"draft":"scheduled",c=new Date(F);c.setHours(14,0,0,0);const u={roundName:Te.trim(),status:o,variantGroups:k.map(p=>({id:a==="editRound"&&p.id.length<15?p.id:b(),groupName:f==="single"?C.trim():p.groupName.trim(),totalPhysicalStock:p.totalPhysicalStock===""?null:Number(p.totalPhysicalStock),stockUnitType:p.stockUnitType,items:p.items.map(h=>({id:a==="editRound"&&h.id.length<15?h.id:b(),name:h.name,price:Number(h.price)||0,stock:-1,limitQuantity:h.limitQuantity===""?null:Number(h.limitQuantity),expirationDate:p.expirationDate?q.fromDate(p.expirationDate):null,stockDeductionAmount:Number(h.deductionAmount)||1}))})),publishAt:q.fromDate(c),deadlineDate:A?q.fromDate(A):null,pickupDate:v?q.fromDate(v):null,pickupDeadlineDate:M?q.fromDate(M):null,isPrepaymentRequired:de,allowedTiers:B?Q:te.concat(["주의 요망"]),preOrderTiers:ue?pe:[]};if(a==="newProduct"){const p={groupName:C.trim(),description:V.trim(),storageType:L,category:$.find(h=>h.id===ne)?.name||"",encoreCount:0,encoreRequesterIds:[]};await mt(p,u,Ze,ke),x.success(t?"상품이 임시저장되었습니다.":"신규 상품이 성공적으로 등록되었습니다.")}else if(a==="newRound"&&m)await ht(m,u),x.success(t?"새 회차가 임시저장되었습니다.":"새로운 판매 회차가 추가되었습니다.");else if(a==="editRound"&&m&&g){const p={groupName:C.trim(),description:V.trim(),storageType:L,category:$.find(w=>w.id===ne)?.name||""},h=T.filter(w=>!w.startsWith("blob:")),O=T.filter(w=>w.startsWith("blob:")).map(w=>G.get(w)).filter(w=>!!w);await xt(m,p,O,h,We),await gt(m,g,u),x.success(t?"수정 내용이 임시저장되었습니다.":"상품 정보가 성공적으로 수정되었습니다.")}y("/admin/products")}catch(o){x.error(`저장 중 오류가 발생했습니다: ${o.message}`)}finally{S(!1)}};return r.useEffect(()=>()=>{T.forEach(t=>{t.startsWith("blob:")&&URL.revokeObjectURL(t)})},[T]),H?e.jsx(Be,{message:"상품 정보를 불러오는 중입니다..."}):e.jsxs(e.Fragment,{children:[e.jsx(Ft,{isOpen:Xe,onClose:()=>Ie(!1),isPreOrderEnabled:ue,setIsPreOrderEnabled:Se,preOrderTiers:pe,setPreOrderTiers:Ae,isSecretProductEnabled:B,setIsSecretProductEnabled:Me,secretTiers:Q,setSecretTiers:Oe}),e.jsxs("div",{className:"product-add-page-wrapper smart-form",children:[e.jsxs("form",{onSubmit:t=>{t.preventDefault(),Ge(!1)},children:[e.jsxs("header",{className:"product-add-header",children:[e.jsx("h1",{children:se}),e.jsxs("div",{className:"header-actions",children:[e.jsxs("button",{type:"button",onClick:()=>Ge(!0),disabled:z,className:"draft-save-button",children:[e.jsx(Ut,{size:18})," 임시저장"]}),e.jsxs("button",{type:"submit",disabled:z,className:"save-button",children:[z?e.jsx(Dt,{}):e.jsx(Ee,{size:18}),d]})]})]}),e.jsxs("main",{className:"main-content-grid-3-col-final",children:[e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"form-section-title",children:[e.jsxs("div",{className:"title-text-group",children:[e.jsx(wt,{size:20,className:"icon-color-product"}),e.jsx("h3",{children:"대표 상품 정보"})]}),a==="newProduct"&&e.jsxs("div",{className:"product-type-toggle-inline",children:[e.jsx("button",{type:"button",className:f==="single"?"active":"",onClick:()=>Le("single"),children:"단일"}),e.jsx("button",{type:"button",className:f==="group"?"active":"",onClick:()=>Le("group"),children:"그룹"})]})]}),e.jsx("p",{className:"section-subtitle",children:"상품의 기본 정보는 모든 판매 회차에 공통 적용됩니다."}),e.jsxs("div",{className:"form-group with-validation",children:[e.jsx("label",{children:"대표 상품명 *"}),e.jsxs("div",{className:"input-wrapper",children:[e.jsx("input",{type:"text",value:C,onChange:t=>K(t.target.value),required:!0,disabled:a!=="newProduct"&&a!=="editRound"}),Je&&e.jsx("div",{className:"input-spinner-wrapper",children:e.jsx(qe,{className:"spinner-icon"})})]}),a==="newProduct"&&ze.length>0&&e.jsxs("div",{className:"similar-products-warning",children:[e.jsxs("span",{children:[e.jsx(Ct,{size:16})," 유사한 이름의 상품이 이미 존재합니다. 새 회차로 추가하시겠어요?"]}),e.jsx("ul",{children:ze.map(t=>e.jsxs("li",{className:"similar-product-item",children:[e.jsx("span",{children:t.groupName}),e.jsx("button",{type:"button",className:"add-round-for-similar-btn",onClick:()=>y("/admin/products/add",{state:{productId:t.id,productGroupName:t.groupName,lastRound:t.salesHistory[0]}}),children:"이 상품에 새 회차 추가"})]},t.id))})]})]}),a==="newProduct"&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"상품 등록일"}),e.jsxs("div",{className:"input-with-icon",children:[e.jsx(Ot,{size:16,className:"input-icon"}),e.jsx("input",{type:"date",value:R(ke),onChange:t=>ve(ee(t.target.value)??new Date),required:!0})]}),e.jsx("p",{className:"input-description",children:"상품이 시스템에 등록된 것으로 표시될 날짜입니다."})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"상세 설명"}),e.jsxs("div",{className:"description-wrapper",children:[e.jsx("textarea",{value:V,onChange:t=>ae(t.target.value),rows:8,placeholder:"이곳에 상품 안내문을 붙여넣고 [AI로 채우기] 버튼을 눌러보세요."}),e.jsxs("button",{type:"button",className:"ai-parse-button",onClick:ct,disabled:me,children:[me?e.jsx(qe,{className:"spinner-icon"}):e.jsx(At,{size:16}),me?"분석 중...":"AI로 채우기"]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"카테고리/보관타입"}),e.jsx("div",{className:"category-select-wrapper",children:e.jsxs("select",{value:ne,onChange:t=>ie(t.target.value),disabled:a!=="editRound"&&a!=="newProduct",children:[e.jsx("option",{value:"",children:"대분류 선택"}),$.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})}),e.jsx("div",{className:"settings-option-group",children:$t.map(t=>e.jsx("button",{type:"button",className:`settings-option-btn ${t.className} ${L===t.key?"active":""}`,onClick:()=>re(t.key),disabled:a!=="editRound"&&a!=="newProduct",children:t.name},t.key))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"대표 이미지 *"}),e.jsx(Nt,{onDragEnd:ot,children:e.jsx(bt,{droppableId:"image-previews",direction:"horizontal",children:t=>e.jsxs("div",{className:"compact-image-uploader",...t.droppableProps,ref:t.innerRef,children:[e.jsx("input",{type:"file",ref:I,onChange:rt,multiple:!0,accept:"image/png, image/jpeg",style:{display:"none"},disabled:a!=="editRound"&&a!=="newProduct"}),T.map((s,i)=>e.jsx(yt,{draggableId:s+i.toString(),index:i,isDragDisabled:a!=="editRound"&&a!=="newProduct",children:(l,n)=>e.jsxs("div",{ref:l.innerRef,...l.draggableProps,...l.dragHandleProps,className:`thumbnail-preview ${n.isDragging?"dragging":""}`,style:{...l.draggableProps.style},children:[e.jsx("img",{src:s,alt:`미리보기 ${i+1}`}),a!=="newRound"&&e.jsx("button",{type:"button",onClick:()=>lt(i),className:"remove-thumbnail-btn",children:e.jsx(Qe,{size:10})})]})},s+i)),t.placeholder,T.length<10&&(a==="editRound"||a==="newProduct")&&e.jsx("button",{type:"button",onClick:()=>I.current?.click(),className:"add-thumbnail-btn",children:e.jsx(Tt,{size:20})})]})})}),a==="newRound"&&e.jsx("p",{className:"input-description",children:"새 회차 추가 시에는 대표 정보(이름, 설명, 이미지 등)도 함께 수정할 수 있습니다."})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("div",{className:"form-section-title",children:e.jsxs("div",{className:"title-text-group",children:[e.jsx(Pt,{size:20,className:"icon-color-option"}),e.jsx("h3",{children:"판매 옵션 *"})]})}),e.jsx("p",{className:"section-subtitle",children:"현재 회차에만 적용되는 옵션, 가격, 재고 등을 설정합니다."}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"회차명"}),e.jsx("input",{type:"text",value:Te,onChange:t=>X(t.target.value),required:!0})]}),k.map(t=>e.jsxs("div",{className:"variant-group-card",children:[e.jsxs("div",{className:"variant-group-header",children:[e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{children:"하위 상품 그룹명 *"}),e.jsx("input",{type:"text",value:t.groupName,onChange:s=>P(t.id,"groupName",s.target.value),placeholder:f==="group"?"예: 얼큰소고기맛":"상품명과 동일하게",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:e.jsx(ge,{content:"판매 기간 전체에 적용될 물리적인 재고 수량입니다. 비워두면 무제한 판매됩니다.",children:e.jsx("span",{children:"총 재고"})})}),e.jsxs("div",{className:"stock-input-wrapper",children:[e.jsx("input",{type:"number",value:t.totalPhysicalStock,onChange:s=>P(t.id,"totalPhysicalStock",s.target.value),placeholder:"실물 재고"}),e.jsx("span",{className:"stock-unit-addon",children:t.stockUnitType||"개"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"유통기한"}),e.jsx("input",{type:"text",value:t.expirationDateInput,onChange:s=>P(t.id,"expirationDateInput",s.target.value),onBlur:s=>et(t.id,s.target.value),placeholder:"YYMMDD",maxLength:8})]}),f==="group"&&e.jsx("button",{type:"button",onClick:()=>st(t.id),className:"remove-variant-group-btn",disabled:k.length<=1,title:k.length<=1?"마지막 그룹은 삭제할 수 없습니다.":"그룹 삭제",children:e.jsx(He,{size:16})})]}),t.items.map(s=>e.jsxs("div",{className:"option-item-section",children:[e.jsxs("div",{className:"option-item-grid-2x2",children:[e.jsxs("div",{className:"form-group-grid item-name",children:[e.jsx("label",{children:"선택지 *"}),e.jsx("input",{type:"text",value:s.name,onChange:i=>xe(t.id,s.id,"name",i.target.value),required:!0})]}),e.jsxs("div",{className:"form-group-grid item-price",children:[e.jsx("label",{children:"가격 *"}),e.jsxs("div",{className:"price-input-wrapper",children:[e.jsx("input",{type:"text",value:vt(s.price),onChange:i=>at(t.id,s.id,i.target.value),required:!0}),e.jsx("span",{children:"원"})]})]}),e.jsxs("div",{className:"form-group-grid item-limit",children:[e.jsx("label",{className:"tooltip-container",children:e.jsx("span",{children:"구매 제한"})}),e.jsx("input",{type:"number",value:s.limitQuantity,onChange:i=>xe(t.id,s.id,"limitQuantity",i.target.value),placeholder:"없음"})]}),e.jsxs("div",{className:"form-group-grid item-deduction",children:[e.jsx("label",{className:"tooltip-container",children:e.jsx("span",{children:"차감 단위 *"})}),e.jsx("input",{type:"number",value:s.deductionAmount,onChange:i=>xe(t.id,s.id,"deductionAmount",i.target.value),required:!0})]})]}),e.jsx("button",{type:"button",onClick:()=>it(t.id,s.id),className:"remove-item-btn",disabled:t.items.length<=1,title:t.items.length<=1?"마지막 옵션은 삭제할 수 없습니다.":"옵션 삭제",children:e.jsx(He,{size:14})})]},s.id)),e.jsx("div",{className:"option-item-actions",children:e.jsx("button",{type:"button",onClick:()=>nt(t.id),className:"add-item-btn",children:"구매 옵션 추가"})})]},t.id)),e.jsx("div",{className:"variant-controls-footer",children:e.jsx("div",{className:"add-group-btn-wrapper",children:f==="group"&&k.length<5&&e.jsx("button",{type:"button",onClick:tt,className:"add-group-btn",children:"하위 상품 그룹 추가"})})})]}),e.jsxs("div",{className:"form-section sticky-section",children:[e.jsx("div",{className:"form-section-title",children:e.jsxs("div",{className:"title-text-group",children:[e.jsx(be,{size:20,className:"icon-color-settings"}),e.jsx("h3",{children:"발행 및 기간 설정"})]})}),e.jsx("p",{className:"section-subtitle",children:"상품의 판매 시점 및 조건을 설정합니다."}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"판매 옵션"}),e.jsxs("div",{className:"settings-option-group",children:[e.jsx(ge,{content:"선입금 필수 상품으로 설정합니다.",children:e.jsxs("button",{type:"button",className:`settings-option-btn ${de?"active":""}`,onClick:()=>Re(!de),children:[e.jsx(Ee,{size:16})," 선입금"]})}),e.jsx(ge,{content:"선주문, 등급별 노출 등 판매 조건을 설정합니다.",children:e.jsxs("button",{type:"button",className:`settings-option-btn ${ue&&pe.length>0||B?"active":""}`,onClick:()=>Ie(!0),children:[e.jsx(be,{size:16})," 등급 설정"]})})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"발행일 (오후 2시 공개)"}),e.jsx("input",{type:"date",value:R(F),onChange:t=>Pe(ee(t.target.value)??new Date),required:!0}),a!=="editRound"&&e.jsx("p",{className:"input-description",children:"선택한 날짜 오후 2시에 공개됩니다."})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"공동구매 마감일 *"}),e.jsx("input",{type:"datetime-local",value:Ve(A),onChange:t=>oe(t.target.value?new Date(t.target.value):null),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"픽업 시작일 *"}),e.jsx("input",{type:"date",value:R(v),onChange:t=>ce(ee(t.target.value)),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"픽업 마감일 *"}),e.jsx("input",{type:"date",value:R(M),onChange:t=>J(ee(t.target.value)),required:!0})]}),e.jsxs("div",{className:"settings-summary-card",children:[e.jsxs("h4",{className:"summary-title",children:[e.jsx(ye,{size:16})," 설정 요약"]}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"발행:"})," ",_.publishText]}),e.jsxs("li",{children:[e.jsx("strong",{children:"마감:"})," ",_.deadlineText]}),e.jsxs("li",{children:[e.jsx("strong",{children:"픽업:"})," ",_.pickupText," - ",_.pickupDeadlineText]}),e.jsxs("li",{children:[e.jsx("strong",{children:"참여 조건:"})," ",_.participationText]})]})]})]})]})]}),z&&e.jsx(Be,{message:"저장 중입니다..."})]})]})};export{is as P};
