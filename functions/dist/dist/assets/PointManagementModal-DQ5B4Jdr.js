import{c as k}from"./createLucideIcon-Df3tO_ja.js";import{a2 as b,C as S,ak as P,al as L,r as o,Q as A,V as l,j as a,am as C}from"./index-BMz7zIRN.js";import{X as E}from"./x-BfIBbJBP.js";import{L as D}from"./loader-circle-B7eOStzy.js";const w=async(s,n,e={})=>{if(!s||!n){console.error("Notification creation failed: userId and message are required.");return}try{const i=b(S,"users",s,"notifications");await P(i,{message:n,read:!1,timestamp:L(),type:e.type||"GENERAL_INFO",link:e.link||""})}catch(i){console.error(`Failed to create notification for user ${s}:`,i)}};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],I=k("database",R),T=({isOpen:s,onClose:n,user:e})=>{const[i,h]=o.useState(""),[c,p]=o.useState(""),[r,d]=o.useState("grant"),[u,x]=o.useState([]),[y,j]=o.useState(!1);o.useEffect(()=>{s&&e?(j(!0),A(e.uid).then(x).catch(()=>l.error("최근 내역 로딩 실패")).finally(()=>j(!1))):(h(""),p(""),d("grant"),x([]))},[s,e]);const N=async()=>{if(!e)return;const t=parseInt(i,10);if(isNaN(t)||t<=0){l.error("유효한 포인트를 입력해주세요.");return}if(!c.trim()){l.error("조정 사유를 입력해주세요.");return}const f=r==="grant"?t:-t,g=async()=>{await C(e.uid,f,c);const m=`[${c}] 사유로 소도 포인트 ${t.toLocaleString()}P가 ${r==="grant"?"지급":"차감"}되었습니다.`,v=r==="grant"?"POINTS_EARNED":"POINTS_USED";await w(e.uid,m,{type:v,link:"/mypage/points"})};l.promise(g(),{loading:"포인트 조정 및 알림 발송 중...",success:()=>(n(),"포인트가 조정되고 알림이 발송되었습니다!"),error:m=>m.message||"작업에 실패했습니다."})};return!s||!e?null:a.jsx("div",{className:"admin-modal-overlay",onClick:n,children:a.jsxs("div",{className:"admin-modal-content",onClick:t=>t.stopPropagation(),children:[a.jsxs("div",{className:"admin-modal-header",children:[a.jsx("h3",{children:"소도 포인트 관리"}),a.jsx("button",{onClick:n,className:"admin-modal-close-button",children:a.jsx(E,{size:24})})]}),a.jsxs("div",{className:"admin-modal-body",children:[a.jsxs("p",{children:[a.jsxs("strong",{children:[e.displayName,e.nickname?` (${e.nickname})`:""]})," 님의 포인트를 조정합니다."]}),a.jsxs("p",{className:"current-points",children:["현재 소도 포인트: ",a.jsxs("strong",{children:[(e.points||0).toLocaleString()," P"]})]}),a.jsxs("div",{className:"point-action-selector",children:[a.jsx("button",{className:r==="grant"?"active":"",onClick:()=>d("grant"),children:"지급"}),a.jsx("button",{className:r==="deduct"?"active":"",onClick:()=>d("deduct"),children:"차감"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"point-amount",children:"조정할 포인트"}),a.jsx("input",{id:"point-amount",type:"number",value:i,onChange:t=>h(t.target.value),placeholder:"숫자만 입력"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"point-reason",children:"조정 사유"}),a.jsx("textarea",{id:"point-reason",value:c,onChange:t=>p(t.target.value),placeholder:"예: 커뮤니티 홍보 인증"})]}),a.jsxs("div",{className:"point-history-preview",children:[a.jsx("h4",{children:"최근 변동 내역 (최대 5건)"}),y?a.jsx("div",{className:"history-loader",children:a.jsx(D,{className:"spin-icon"})}):a.jsx("ul",{children:u.length>0?u.map(t=>a.jsxs("li",{children:[a.jsx("span",{className:"history-date",children:t.createdAt?.toDate().toLocaleDateString("ko-KR")}),a.jsx("span",{className:"history-reason",children:t.reason}),a.jsxs("span",{className:`history-amount ${t.amount>0?"positive":"negative"}`,children:[t.amount>0?"+":"",t.amount.toLocaleString()," P"]})]},t.id)):a.jsx("p",{children:"최근 포인트 변동 내역이 없습니다."})})]})]}),a.jsxs("div",{className:"admin-modal-footer",children:[a.jsx("button",{onClick:n,className:"modal-button secondary",children:"취소"}),a.jsx("button",{onClick:N,className:"modal-button primary",children:"저장"})]})]})})};export{I as D,T as P};
