<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì†Œë„ëª° ê´€ë¦¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f4f4f9; }
        h1 { color: #333; }
        p { color: #555; }
        button {
            background-color: #d9534f; color: white; padding: 15px 25px;
            border: none; border-radius: 5px; font-size: 16px; cursor: pointer;
        }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        pre { background-color: #eee; padding: 15px; border-radius: 5px; white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body>

    <h1>âœ… ê¸°ì¡´ ìƒí’ˆ isVisible í•„ë“œ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸</h1>
    <p>
        ì´ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ëª¨ë“  ê¸°ì¡´ ìƒí’ˆ ë°ì´í„°ì— `isVisible` í•„ë“œë¥¼ ì¶”ê°€í•˜ê³ ,
        í˜„ì¬ íŒë§¤ ìƒíƒœì— ë”°ë¼ ì´ˆê¸°ê°’ì„ ì„¤ì •í•©ë‹ˆë‹¤. <strong>ë°ì´í„°ê°€ ë§ì„ ê²½ìš° ëª‡ ë¶„ ì •ë„ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</strong>
    </p>
    <button id="runScriptBtn">ì§€ê¸ˆ ë°”ë¡œ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰</button>
    <hr style="margin: 20px 0;">
    <h3>ì‹¤í–‰ ê²°ê³¼:</h3>
    <pre id="result">ì•„ì§ ì‹¤í–‰ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</pre>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-functions-compat.js"></script>

    <script>
        // ğŸš¨ğŸš¨ğŸš¨ [ì—¬ê¸°ì— Firebase ì„¤ì • ë³µì‚¬] ğŸš¨ğŸš¨ğŸš¨
        const firebaseConfig = {
            apiKey: "AIza...",
            authDomain: "sso-do.firebaseapp.com",
            projectId: "sso-do",
            storageBucket: "sso-do.appspot.com",
            messagingSenderId: "...",
            appId: "1:..."
        };

        // Firebase ì•± ì´ˆê¸°í™”
        firebase.initializeApp(firebaseConfig);
        const functions = firebase.functions('asia-northeast3');
        const runScriptBtn = document.getElementById('runScriptBtn');
        const resultDiv = document.getElementById('result');

        runScriptBtn.addEventListener('click', async () => {
            if (!confirm('ì •ë§ë¡œ ëª¨ë“  ê¸°ì¡´ ìƒí’ˆì˜ isVisible í•„ë“œë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ í•œ ë²ˆë§Œ ì‹¤í–‰í•˜ë©´ ë©ë‹ˆë‹¤.')) {
                return;
            }

            runScriptBtn.disabled = true;
            resultDiv.textContent = 'ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì¤‘... ë¸Œë¼ìš°ì €ë¥¼ ë‹«ì§€ ë§ˆì„¸ìš”.';

            try {
                // Cloud Function í˜¸ì¶œ
                const backfillProductVisibility = functions.httpsCallable('backfillProductVisibility');
                const response = await backfillProductVisibility();
                
                resultDiv.textContent = 'ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì„±ê³µ!\n\n';
                resultDiv.textContent += JSON.stringify(response.data, null, 2);

            } catch (error) {
                console.error("ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì‹¤íŒ¨:", error);
                resultDiv.textContent = 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ê°œë°œì ì½˜ì†”(F12)ì„ í™•ì¸í•´ì£¼ì„¸ìš”.\n\n';
                resultDiv.textContent += error.message;
            } finally {
                runScriptBtn.disabled = false;
            }
        });
    </script>
</body>
</html>